<!doctype html>
<html lang="he" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>××¢×¨×›×ª × ×™×ª×•×— ELISA - HSV Color Analysis</title>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100%;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .upload-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .upload-area {
            border: 3px dashed #4facfe;
            border-radius: 15px;
            padding: 40px;
            background: #f8fbff;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area:hover {
            border-color: #00f2fe;
            background: #f0f9ff;
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #00f2fe;
            background: #e3f2fd;
            transform: scale(1.02);
        }

        .file-input {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }

        .image-container {
            position: relative;
            text-align: center;
            margin: 20px 0;
            background: #f5f5f5;
            border-radius: 15px;
            overflow: hidden;
        }

        .plate-image {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }

        .image-container {
            overflow: hidden;
            border: 2px solid #ddd;
        }

        .image-and-controls {
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 20px;
            margin: 20px 0;
            align-items: start;
        }

        .grid-controls-sidebar {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            border: 1px solid #e9ecef;
            position: sticky;
            top: 20px;
            max-height: calc(100% - 40px);
            overflow-y: auto;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .control-buttons {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .small-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .small-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
        }

        .small-btn:active {
            transform: translateY(0);
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .analyze-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
        }

        .analyze-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .help-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #17a2b8;
            color: white;
            border: none;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .help-btn:hover {
            transform: scale(1.1);
            background: #138496;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 800px;
            max-height: 80%;
            overflow-y: auto;
            position: relative;
        }

        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            top: 15px;
            left: 25px;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .hidden {
            display: none;
        }

        /* ×œ×•×— ×‘×—×™×¨×ª ×‘××¨×™×•×ª */
        .well-grid {
            display: grid;
            grid-template-columns: repeat(12, 1fr);
            grid-template-rows: repeat(8, 1fr);
            gap: 6px;
            background: white;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 12px;
            max-width: 600px;
            direction: ltr;
        }

        .well-button {
            aspect-ratio: 1;
            border: 2px solid #ddd;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            min-width: 40px;
            min-height: 40px;
        }

        .well-button:hover {
            border-color: #4facfe;
            background: #f0f9ff;
            transform: scale(1.1);
        }

        .well-button.selected {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-color: #0066cc;
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.4);
        }

        .well-button.selected:hover {
            background: linear-gradient(135deg, #0066cc 0%, #0088cc 100%);
        }

        /* ×ª×•×¦××•×ª */
        .results {
            margin-top: 30px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }

        .results h3 {
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5em;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .results-table th,
        .results-table td {
            padding: 12px;
            text-align: center;
            border: 1px solid #ddd;
        }

        .results-table th {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-weight: bold;
        }

        .results-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .results-table tr:hover {
            background-color: #e3f2fd;
        }

        /* ×’×¨×£ */
        #chartSection {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        #intensityChart {
            max-width: 100%;
            height: auto;
            cursor: crosshair;
        }

        /* ×¦×‘×¢×™ ×©×•×¨×•×ª */
        .row-A { background-color: #FF6B6B !important; }
        .row-B { background-color: #4ECDC4 !important; }
        .row-C { background-color: #45B7D1 !important; }
        .row-D { background-color: #96CEB4 !important; }
        .row-E { background-color: #FFEAA7 !important; }
        .row-F { background-color: #DDA0DD !important; }
        .row-G { background-color: #98D8C8 !important; }
        .row-H { background-color: #F7DC6F !important; }

        /* ×›×¤×ª×•×¨×™ ×‘×—×™×¨×” ×œ×”×©×•×•××•×ª */
        .group-select-btn {
            padding: 6px 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            background: white;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .group-select-btn:hover {
            border-color: #4facfe;
            background: #f0f9ff;
        }

        .group-select-btn.selected-a {
            background: #4facfe;
            color: white;
            border-color: #0066cc;
        }

        .group-select-btn.selected-b {
            background: #17a2b8;
            color: white;
            border-color: #117a8b;
        }

        .comparison-tab {
            transition: all 0.3s ease;
        }

        .comparison-tab:hover {
            transform: translateY(-2px);
        }

        .comparison-tab.active {
            background: #ff9800 !important;
            color: white !important;
        }

        @media (max-width: 768px) {
            .image-and-controls {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .grid-controls-sidebar {
                position: static;
                max-height: none;
                order: -1;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .main-content {
                padding: 20px;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div class="header">
    <h1>ğŸ§ª ××¢×¨×›×ª × ×™×ª×•×— ELISA</h1>
    <p>× ×™×ª×•×— HSV ××ª×§×“× ×œ×¢×•×¦××ª ×¦×‘×¢ ×‘×‘××¨×™×•×ª</p>
   </div>
   <div class="main-content"><!-- ×”×¢×œ××ª ×ª××•× ×” -->
    <div class="upload-section">
     <div class="upload-area" id="uploadArea">
      <div style="font-size: 48px; margin-bottom: 20px;">
       ğŸ“¸
      </div>
      <h3>×”×¢×œ×” ×ª××•× ×ª ×¦×œ×—×ª ELISA</h3>
      <p style="color: #666; margin: 10px 0;">×’×¨×•×¨ ×•×©×—×¨×¨ ×ª××•× ×” ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</p><button class="upload-btn" type="button" id="uploadButton"> ğŸ“ ×‘×—×¨ ×ª××•× ×” ××”××—×©×‘ </button> <input type="file" id="fileInput" class="file-input" accept="image/*">
     </div>
    </div><!-- ×ª×¦×•×’×ª ×”×ª××•× ×” -->
    <div id="imageSection" class="hidden"><!-- ×ª××•× ×” ×•×‘×§×¨×•×ª ×¨×©×ª -->
     <div class="image-and-controls">
      <div class="image-container" style="position: relative; display: inline-block; margin: 0 auto;"><img id="plateImage" class="plate-image" alt="ELISA Plate" style="display: block; position: relative;">
       <canvas id="gridOverlay" style="position: absolute; top: 0; left: 0; pointer-events: none; z-index: 10;"></canvas>
      </div><!-- ×‘×§×¨×•×ª ×¨×©×ª ×‘×¦×“ ×”×ª××•× ×” -->
      <div class="grid-controls-sidebar">
       <h3 style="color: #4facfe; margin-bottom: 15px; text-align: center;">ğŸ›ï¸ ×‘×§×¨×•×ª ×¨×©×ª</h3>
       <div class="control-group">
        <h4>××™×§×•× ×¨×©×ª</h4>
        <div class="control-buttons"><button class="small-btn" data-action="left" title="×”×–×– ×©×××œ×”">â†</button> <button class="small-btn" data-action="right" title="×”×–×– ×™××™× ×”">â†’</button> <button class="small-btn" data-action="up" title="×”×–×– ×œ××¢×œ×”">â†‘</button> <button class="small-btn" data-action="down" title="×”×–×– ×œ××˜×”">â†“</button>
        </div>
       </div>
       <div class="control-group">
        <h4>××¨×•×•×—×™×</h4>
        <div class="control-buttons"><button class="small-btn" data-action="spacingXUp" title="×”×’×“×œ ××¨×•×•×— ××•×¤×§×™">âŸ·+</button> <button class="small-btn" data-action="spacingXDown" title="×”×§×˜×Ÿ ××¨×•×•×— ××•×¤×§×™">âŸ·-</button> <button class="small-btn" data-action="spacingYUp" title="×”×’×“×œ ××¨×•×•×— ×× ×›×™">â†•+</button> <button class="small-btn" data-action="spacingYDown" title="×”×§×˜×Ÿ ××¨×•×•×— ×× ×›×™">â†•-</button>
        </div>
       </div>
       <div class="control-group">
        <h4>×’×•×“×œ ×‘××¨×™×•×ª</h4>
        <div class="control-buttons"><button class="small-btn" data-action="sizeUp" title="×”×’×“×œ ×‘××¨×™×•×ª">ğŸ”+</button> <button class="small-btn" data-action="sizeDown" title="×”×§×˜×Ÿ ×‘××¨×™×•×ª">ğŸ”-</button>
        </div>
       </div>
       <div class="control-group">
        <h4>×ª×¦×•×’×”</h4>
        <div class="control-buttons"><button class="small-btn" id="gridToggle" onclick="toggleGrid()" style="background: #28a745;" title="×”×¡×ª×¨/×”×¦×’ ×¨×©×ª">ğŸ‘ï¸</button>
        </div>
       </div>
       <div style="background: #f0f9ff; border: 1px solid #4facfe; border-radius: 8px; padding: 10px; margin-top: 15px;">
        <div style="font-size: 11px; color: #1976d2; text-align: center;"><strong>ğŸ’¡ ×˜×™×¤:</strong><br>
          ×›×•×•×Ÿ ××ª ×”×¨×©×ª ×‘×“×™×•×§<br>
          ×¢×œ ×”×‘××¨×™×•×ª ×‘×ª××•× ×”<br>
          ×œ×¤× ×™ ×‘×—×™×¨×ª ×‘××¨×™×•×ª
        </div>
       </div>
      </div>
     </div><!-- ×œ×•×— ×‘×—×™×¨×ª ×‘××¨×™×•×ª -->
     <div class="well-selection-section">
      <div style="background: #f8fbff; border: 1px solid #e3f2fd; border-radius: 10px; padding: 20px; margin: 20px 0; border-right: 5px solid #4facfe;">
       <h3 style="color: #1976d2; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">ğŸ¯ ×‘×—×™×¨×ª ×‘××¨×™×•×ª ×œ× ×™×ª×•×—</h3>
       <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <div>
         <h4 style="margin-bottom: 10px;">×œ×•×— ×‘×—×™×¨×” ×•×™×–×•××œ×™:</h4><!-- ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×©×•×¨×•×ª -->
         <div style="margin-bottom: 10px;">
          <div style="font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #333;">
           ğŸ”¸ ×‘×—×™×¨×ª ×©×•×¨×•×ª:
          </div>
          <div style="display: flex; gap: 5px; flex-wrap: wrap;"><button class="small-btn" onclick="selectRow('H')" style="background: #F7DC6F; color: black; font-size: 14px; padding: 8px 12px; min-width: 40px; min-height: 35px;">H</button> <button class="small-btn" onclick="selectRow('G')" style="background: #98D8C8; color: white; font-size: 14px; padding: 8px 12px; min-width: 40px; min-height: 35px;">G</button> <button class="small-btn" onclick="selectRow('F')" style="background: #DDA0DD; color: white; font-size: 14px; padding: 8px 12px; min-width: 40px; min-height: 35px;">F</button> <button class="small-btn" onclick="selectRow('E')" style="background: #FFEAA7; color: black; font-size: 14px; padding: 8px 12px; min-width: 40px; min-height: 35px;">E</button> <button class="small-btn" onclick="selectRow('D')" style="background: #96CEB4; color: white; font-size: 14px; padding: 8px 12px; min-width: 40px; min-height: 35px;">D</button> <button class="small-btn" onclick="selectRow('C')" style="background: #45B7D1; color: white; font-size: 14px; padding: 8px 12px; min-width: 40px; min-height: 35px;">C</button> <button class="small-btn" onclick="selectRow('B')" style="background: #4ECDC4; color: white; font-size: 14px; padding: 8px 12px; min-width: 40px; min-height: 35px;">B</button> <button class="small-btn" onclick="selectRow('A')" style="background: #FF6B6B; color: white; font-size: 14px; padding: 8px 12px; min-width: 40px; min-height: 35px;">A</button>
          </div>
         </div><!-- ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×¢××•×“×•×ª -->
         <div style="margin-bottom: 10px;">
          <div style="font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #333;">
           ğŸ”¹ ×‘×—×™×¨×ª ×¢××•×“×•×ª:
          </div>
          <div style="display: flex; gap: 4px; flex-wrap: wrap; direction: ltr;"><button class="small-btn" onclick="selectColumn(1)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">1</button> <button class="small-btn" onclick="selectColumn(2)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">2</button> <button class="small-btn" onclick="selectColumn(3)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">3</button> <button class="small-btn" onclick="selectColumn(4)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">4</button> <button class="small-btn" onclick="selectColumn(5)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">5</button> <button class="small-btn" onclick="selectColumn(6)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">6</button> <button class="small-btn" onclick="selectColumn(7)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">7</button> <button class="small-btn" onclick="selectColumn(8)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">8</button> <button class="small-btn" onclick="selectColumn(9)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">9</button> <button class="small-btn" onclick="selectColumn(10)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">10</button> <button class="small-btn" onclick="selectColumn(11)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">11</button> <button class="small-btn" onclick="selectColumn(12)" style="background: #6c757d; color: white; font-size: 12px; padding: 6px 10px; min-width: 35px; min-height: 30px;">12</button>
          </div>
         </div><!-- ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×˜×•×•×—×™× -->
         <div style="margin-bottom: 10px;">
          <div style="font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #333;">
           ğŸ“ ×‘×—×™×¨×ª ×˜×•×•×—×™×:
          </div>
          <div style="display: flex; gap: 5px; flex-wrap: wrap;"><button class="small-btn" onclick="selectRange('A1', 'D12')" style="background: #17a2b8; color: white; font-size: 12px; padding: 6px 10px; min-width: 45px; min-height: 30px;" title="×©×•×¨×•×ª A-D, ×›×œ ×”×¢××•×“×•×ª">A-D</button> <button class="small-btn" onclick="selectRange('E1', 'H12')" style="background: #17a2b8; color: white; font-size: 12px; padding: 6px 10px; min-width: 45px; min-height: 30px;" title="×©×•×¨×•×ª E-H, ×›×œ ×”×¢××•×“×•×ª">E-H</button> <button class="small-btn" onclick="selectRange('A1', 'H6')" style="background: #17a2b8; color: white; font-size: 12px; padding: 6px 10px; min-width: 45px; min-height: 30px;" title="×›×œ ×”×©×•×¨×•×ª, ×¢××•×“×•×ª 1-6">1-6</button> <button class="small-btn" onclick="selectRange('A7', 'H12')" style="background: #17a2b8; color: white; font-size: 12px; padding: 6px 10px; min-width: 45px; min-height: 30px;" title="×›×œ ×”×©×•×¨×•×ª, ×¢××•×“×•×ª 7-12">7-12</button>
          </div>
         </div>
         <div id="wellSelectionGrid" class="well-grid" style="direction: ltr;"><!-- ×”×œ×•×— ×™×•×•×¦×¨ ×‘××•×¤×Ÿ ×“×™× ××™ -->
         </div>
        </div>
        <div><!-- ×‘××¨×™×•×ª ×œ×‘×“×™×§×” -->
         <div>
          <h4 style="margin-bottom: 8px;">ğŸ“Š ×‘××¨×™×•×ª ×œ×‘×“×™×§×”:</h4>
          <div id="selectedWellsList" style="background: white; border: 1px solid #ddd; border-radius: 5px; padding: 10px; min-height: 80px; max-height: 120px; overflow-y: auto; font-family: monospace;"><em style="color: #666;">×œ× × ×‘×—×¨×• ×‘××¨×™×•×ª ×¢×“×™×™×Ÿ</em>
          </div>
          <div style="margin-top: 8px;"><button class="btn" onclick="selectAllWells()" style="background: #28a745; font-size: 10px; padding: 4px 8px;"> âœ… ×‘×—×¨ ×”×›×œ </button> <button class="btn" onclick="clearAllWells()" style="background: #dc3545; font-size: 10px; padding: 4px 8px;"> âŒ × ×§×” ×”×›×œ </button>
          </div>
         </div>
        </div>
       </div>
       <div style="text-align: center;"><button class="analyze-btn" onclick="analyzeSelectedWells()" id="analyzeBtn" disabled> ğŸ”¬ × ×ª×— ×‘××¨×™×•×ª × ×‘×—×¨×•×ª </button>
       </div>
      </div>
     </div>
    </div><!-- ×ª×•×¦××•×ª -->
    <div id="resultsSection" class="results hidden">
     <div style="margin-bottom: 15px;">
      <h3>ğŸ“Š ×ª×•×¦××•×ª × ×™×ª×•×—</h3>
     </div><!-- ×˜×‘×œ×ª ×ª×•×¦××•×ª -->
     <table class="results-table" id="resultsTable" style="direction: ltr;">
      <thead>
       <tr>
        <th>×‘××¨×™×ª</th>
        <th>×¢×•×¦××ª ×¦×‘×¢ HSV</th>
       </tr>
      </thead>
      <tbody id="resultsBody">
      </tbody>
     </table><!-- ×’×¨×£ ××™× ×˜×¨××§×˜×™×‘×™ -->
     <div id="chartSection" style="background: white; border-radius: 10px; padding: 20px; margin-top: 20px; border: 1px solid #ddd;">
      <h4 style="text-align: center; margin-bottom: 15px; color: #333;">ğŸ“ˆ ×’×¨×£ ×¢×•×¦××ª ×¦×‘×¢</h4>
      <canvas id="intensityChart" width="1200" height="600" style="max-width: 100%; height: auto; cursor: crosshair;"></canvas>
      <div id="chartTooltip" style="position: absolute; background: rgba(0,0,0,0.8); color: white; padding: 8px 12px; border-radius: 5px; font-size: 12px; pointer-events: none; display: none; z-index: 1000;"></div>
     </div><!-- ×‘×“×™×§×ª ××•×‘×”×§×•×ª ××•×˜×•××˜×™×ª -->
     <div id="statisticalSection" style="background: #f0f9ff; border: 2px solid #4facfe; border-radius: 15px; padding: 20px; margin-top: 20px;">
      <h4 style="color: #1976d2; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">ğŸ¤– × ×™×ª×•×— ××•×‘×”×§×•×ª ××•×˜×•××˜×™</h4>
      <div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 8px; padding: 12px; margin-bottom: 15px; text-align: center;">
       <div style="font-size: 14px; color: #2e7d32;"><strong>âœ¨ ×”××¢×¨×›×ª ×‘×•×“×§×ª ××•×˜×•××˜×™×ª ××ª ×›×œ ×”×”×©×•×•××•×ª ×”××¤×©×¨×™×•×ª</strong><br><span style="font-size: 12px;">××¦×™×’×” ×¨×§ ×”×‘×“×œ×™× ××•×‘×”×§×™× ×¡×˜×˜×™×¡×˜×™×ª (p &lt; 0.05)</span>
       </div>
      </div><!-- ×ª×•×¦××•×ª ×‘×“×™×§×ª ×”××•×‘×”×§×•×ª ×”××•×˜×•××˜×™×ª -->
      <div id="statisticalResults" style="background: white; border-radius: 10px; padding: 15px; border: 1px solid #e3f2fd;">
       <div id="statisticalContent">
        <div style="text-align: center; color: #666; padding: 20px;"><em>×ª×•×¦××•×ª ×”× ×™×ª×•×— ×”×¡×˜×˜×™×¡×˜×™ ×™×•×¤×™×¢×• ×›××Ÿ ×œ××—×¨ ×‘×™×¦×•×¢ ×”× ×™×ª×•×—</em>
        </div>
       </div>
      </div>
     </div><!-- ×”×©×•×•××•×ª ××•×ª×××•×ª ××™×©×™×ª -->
     <div id="customComparisonsSection" style="background: #fff3e0; border: 2px solid #ff9800; border-radius: 15px; padding: 20px; margin-top: 20px;">
      <h4 style="color: #e65100; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">ğŸ¯ ×”×©×•×•××•×ª ××•×ª×××•×ª ××™×©×™×ª</h4>
      <div style="background: #fff8e1; border: 1px solid #ffc107; border-radius: 8px; padding: 12px; margin-bottom: 15px; text-align: center;">
       <div style="font-size: 14px; color: #f57c00;"><strong>ğŸ”¬ ×‘×—×¨ ×§×‘×•×¦×•×ª ×œ×”×©×•×•××” ×¡×˜×˜×™×¡×˜×™×ª</strong><br><span style="font-size: 12px;">×”×©×•×•×” ×‘×™×Ÿ ×©×•×¨×•×ª, ×¢××•×“×•×ª ××• ×§×‘×•×¦×•×ª ××•×ª×××•×ª ××™×©×™×ª</span>
       </div>
      </div><!-- ×˜××‘×™× ×œ×‘×—×™×¨×ª ×¡×•×’ ×”×”×©×•×•××” -->
      <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ddd;"><button class="comparison-tab active" data-tab="rows" onclick="switchComparisonTab('rows')" style="flex: 1; padding: 12px; border: none; background: #ff9800; color: white; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: bold; transition: all 0.3s;"> ğŸ”¸ ×”×©×•×•××ª ×©×•×¨×•×ª </button> <button class="comparison-tab" data-tab="columns" onclick="switchComparisonTab('columns')" style="flex: 1; padding: 12px; border: none; background: #e0e0e0; color: #666; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: bold; transition: all 0.3s;"> ğŸ”¹ ×”×©×•×•××ª ×¢××•×“×•×ª </button> <button class="comparison-tab" data-tab="custom" onclick="switchComparisonTab('custom')" style="flex: 1; padding: 12px; border: none; background: #e0e0e0; color: #666; border-radius: 8px 8px 0 0; cursor: pointer; font-weight: bold; transition: all 0.3s;"> âš¡ ×§×‘×•×¦×•×ª ××•×ª×××•×ª </button>
      </div><!-- ×ª×•×›×Ÿ ×˜××‘ ×”×©×•×•××ª ×©×•×¨×•×ª -->
      <div id="rowsComparisonTab" class="comparison-tab-content" style="display: block;">
       <div style="background: white; border-radius: 10px; padding: 20px; border: 1px solid #e3f2fd;">
        <h5 style="color: #333; margin-bottom: 15px;">×‘×—×¨ ×©×•×¨×•×ª ×œ×”×©×•×•××”:</h5>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
         <div><label style="display: block; font-weight: bold; margin-bottom: 8px; color: #4facfe;">×§×‘×•×¦×” A (×©×•×¨×•×ª):</label>
          <div id="rowGroupA" style="display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px;"><!-- ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×©×•×¨×•×ª ×™×•×•×¦×¨×• ×“×™× ××™×ª -->
          </div>
          <div style="font-size: 12px; color: #666; background: #f5f5f5; padding: 8px; border-radius: 5px; min-height: 40px;" id="rowGroupAList"><em>×œ× × ×‘×—×¨×• ×©×•×¨×•×ª</em>
          </div>
         </div>
         <div><label style="display: block; font-weight: bold; margin-bottom: 8px; color: #17a2b8;">×§×‘×•×¦×” B (×©×•×¨×•×ª):</label>
          <div id="rowGroupB" style="display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px;"><!-- ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×©×•×¨×•×ª ×™×•×•×¦×¨×• ×“×™× ××™×ª -->
          </div>
          <div style="font-size: 12px; color: #666; background: #f5f5f5; padding: 8px; border-radius: 5px; min-height: 40px;" id="rowGroupBList"><em>×œ× × ×‘×—×¨×• ×©×•×¨×•×ª</em>
          </div>
         </div>
        </div>
        <div style="text-align: center; margin-top: 20px;"><button class="btn" onclick="compareRowGroups()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); padding: 12px 30px; font-size: 14px;"> ğŸ”¬ ×”×©×•×•×” ×§×‘×•×¦×•×ª ×©×•×¨×•×ª </button>
        </div>
       </div>
      </div><!-- ×ª×•×›×Ÿ ×˜××‘ ×”×©×•×•××ª ×¢××•×“×•×ª -->
      <div id="columnsComparisonTab" class="comparison-tab-content" style="display: none;">
       <div style="background: white; border-radius: 10px; padding: 20px; border: 1px solid #e3f2fd;">
        <h5 style="color: #333; margin-bottom: 15px;">×‘×—×¨ ×¢××•×“×•×ª ×œ×”×©×•×•××”:</h5>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
         <div><label style="display: block; font-weight: bold; margin-bottom: 8px; color: #4facfe;">×§×‘×•×¦×” A (×¢××•×“×•×ª):</label>
          <div id="colGroupA" style="display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px;"><!-- ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×¢××•×“×•×ª ×™×•×•×¦×¨×• ×“×™× ××™×ª -->
          </div>
          <div style="font-size: 12px; color: #666; background: #f5f5f5; padding: 8px; border-radius: 5px; min-height: 40px;" id="colGroupAList"><em>×œ× × ×‘×—×¨×• ×¢××•×“×•×ª</em>
          </div>
         </div>
         <div><label style="display: block; font-weight: bold; margin-bottom: 8px; color: #17a2b8;">×§×‘×•×¦×” B (×¢××•×“×•×ª):</label>
          <div id="colGroupB" style="display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px;"><!-- ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×¢××•×“×•×ª ×™×•×•×¦×¨×• ×“×™× ××™×ª -->
          </div>
          <div style="font-size: 12px; color: #666; background: #f5f5f5; padding: 8px; border-radius: 5px; min-height: 40px;" id="colGroupBList"><em>×œ× × ×‘×—×¨×• ×¢××•×“×•×ª</em>
          </div>
         </div>
        </div>
        <div style="text-align: center; margin-top: 20px;"><button class="btn" onclick="compareColumnGroups()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); padding: 12px 30px; font-size: 14px;"> ğŸ”¬ ×”×©×•×•×” ×§×‘×•×¦×•×ª ×¢××•×“×•×ª </button>
        </div>
       </div>
      </div><!-- ×ª×•×›×Ÿ ×˜××‘ ×§×‘×•×¦×•×ª ××•×ª×××•×ª -->
      <div id="customComparisonTab" class="comparison-tab-content" style="display: none;">
       <div style="background: white; border-radius: 10px; padding: 20px; border: 1px solid #e3f2fd;">
        <h5 style="color: #333; margin-bottom: 15px;">×‘×—×¨ ×‘××¨×™×•×ª ×¡×¤×¦×™×¤×™×•×ª ×œ×”×©×•×•××”:</h5>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
         <div><label style="display: block; font-weight: bold; margin-bottom: 8px; color: #4facfe;">×§×‘×•×¦×” A (×‘××¨×™×•×ª):</label>
          <div style="background: #f8f9fa; border: 1px solid #ddd; border-radius: 5px; padding: 10px; margin-bottom: 10px; max-height: 150px; overflow-y: auto;">
           <div id="customGroupAWells" style="display: flex; gap: 5px; flex-wrap: wrap;"><!-- ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×‘××¨×™×•×ª ×™×•×•×¦×¨×• ×“×™× ××™×ª -->
           </div>
          </div>
          <div style="font-size: 12px; color: #666; background: #f5f5f5; padding: 8px; border-radius: 5px; min-height: 40px;" id="customGroupAList"><em>×œ× × ×‘×—×¨×• ×‘××¨×™×•×ª</em>
          </div>
         </div>
         <div><label style="display: block; font-weight: bold; margin-bottom: 8px; color: #17a2b8;">×§×‘×•×¦×” B (×‘××¨×™×•×ª):</label>
          <div style="background: #f8f9fa; border: 1px solid #ddd; border-radius: 5px; padding: 10px; margin-bottom: 10px; max-height: 150px; overflow-y: auto;">
           <div id="customGroupBWells" style="display: flex; gap: 5px; flex-wrap: wrap;"><!-- ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×‘××¨×™×•×ª ×™×•×•×¦×¨×• ×“×™× ××™×ª -->
           </div>
          </div>
          <div style="font-size: 12px; color: #666; background: #f5f5f5; padding: 8px; border-radius: 5px; min-height: 40px;" id="customGroupBList"><em>×œ× × ×‘×—×¨×• ×‘××¨×™×•×ª</em>
          </div>
         </div>
        </div>
        <div style="text-align: center; margin-top: 20px;"><button class="btn" onclick="compareCustomGroups()" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); padding: 12px 30px; font-size: 14px;"> ğŸ”¬ ×”×©×•×•×” ×§×‘×•×¦×•×ª ××•×ª×××•×ª </button>
        </div>
       </div>
      </div><!-- ×ª×•×¦××•×ª ×”×”×©×•×•××” ×”××•×ª×××ª -->
      <div id="customComparisonResults" style="background: white; border-radius: 10px; padding: 15px; margin-top: 20px; border: 1px solid #e3f2fd; display: none;">
       <h5 style="color: #333; margin-bottom: 15px; text-align: center;">ğŸ“Š ×ª×•×¦××•×ª ×”×”×©×•×•××”</h5>
       <div id="customComparisonContent"></div>
      </div>
     </div>
    </div>
   </div>
  </div><!-- ×›×¤×ª×•×¨ ×¢×–×¨×” --> <button class="help-btn" onclick="showHelp()">â“</button> <!-- ×—×œ×•×Ÿ ×¢×–×¨×” -->
  <div id="helpModal" class="modal">
   <div class="modal-content"><span class="close" onclick="closeHelp()">Ã—</span>
    <h2 style="text-align: center; color: #4facfe; margin-bottom: 20px;">ğŸ“– ××“×¨×™×š ×©×™××•×© - × ×™×ª×•×— HSV</h2>
    <div style="line-height: 1.6;">
     <h3>ğŸ¯ ×©×œ×‘×™ ×”×©×™××•×©:</h3>
     <ol>
      <li><strong>×”×¢×œ×” ×ª××•× ×”:</strong> ×’×¨×•×¨ ×ª××•× ×ª ELISA ××• ×œ×—×¥ ×œ×‘×—×™×¨×”</li>
      <li><strong>×›×•×•×Ÿ ××ª ×”×¨×©×ª:</strong> ×”×©×ª××© ×‘×›×¤×ª×•×¨×™ ×”×‘×§×¨×” ×œ×›×™×•×•×Ÿ ××“×•×™×§</li>
      <li><strong>×‘×—×¨ ×‘××¨×™×•×ª:</strong> ×œ×—×¥ ×¢×œ ×”×‘××¨×™×•×ª ×”×¨×¦×•×™×•×ª ××• ×”×©×ª××© ×‘×›×¤×ª×•×¨×™ ×”×‘×—×™×¨×” ×”××”×™×¨×”</li>
      <li><strong>×”×¨×¥ × ×™×ª×•×—:</strong> ×œ×—×¥ ×¢×œ ×›×¤×ª×•×¨ ×”× ×™×ª×•×— ×œ×§×‘×œ×ª ×ª×•×¦××•×ª HSV</li>
     </ol>
     <h3>ğŸ”§ ×‘×§×¨×•×ª ×”×¨×©×ª:</h3>
     <ul>
      <li><strong>×—×™×¦×™×:</strong> ×”×–×–×ª ××™×§×•× ×”×¨×©×ª</li>
      <li><strong>××¨×•×•×—×™×:</strong> ×”×ª×××ª ×”××¨×—×§ ×‘×™×Ÿ ×‘××¨×™×•×ª</li>
      <li><strong>×’×•×“×œ:</strong> ×©×™× ×•×™ ×’×•×“×œ ×”×‘××¨×™×•×ª</li>
      <li><strong>×ª×¦×•×’×”:</strong> ×”×¡×ª×¨×”/×”×¦×’×” ×©×œ ×”×¨×©×ª</li>
     </ul>
     <h3>ğŸ“Š ×ª×•×¦××•×ª:</h3>
     <ul>
      <li><strong>×˜×‘×œ×”:</strong> ×¢×¨×›×™ ×¢×•×¦××ª ×¦×‘×¢ ×œ×›×œ ×‘××¨×™×ª</li>
      <li><strong>×’×¨×£:</strong> ×”×¦×’×” ×•×™×–×•××œ×™×ª ×©×œ ×”×ª×•×¦××•×ª</li>
      <li><strong>×¦×‘×¢×™×:</strong> ×¨×§×¢ ×‘×”×ª×× ×œ×¢×•×¦××ª ×”×¦×‘×¢</li>
     </ul>
     <h3>ğŸ“ˆ ×‘×“×™×§×ª ××•×‘×”×§×•×ª:</h3>
     <ul>
      <li><strong>× ×™×ª×•×— ××•×˜×•××˜×™:</strong> ×”××¢×¨×›×ª ×‘×•×“×§×ª ××ª ×›×œ ×”×”×©×•×•××•×ª ×”××¤×©×¨×™×•×ª</li>
      <li><strong>×”×©×•×•××•×ª ××•×ª×××•×ª:</strong> ×‘×—×¨ ×©×•×¨×•×ª, ×¢××•×“×•×ª ××• ×‘××¨×™×•×ª ×¡×¤×¦×™×¤×™×•×ª ×œ×”×©×•×•××”</li>
      <li><strong>t-test:</strong> ×‘×“×™×§×ª ×”×‘×“×œ ××•×‘×”×§ ×‘×™×Ÿ ×§×‘×•×¦×•×ª (p&lt;0.05)</li>
      <li><strong>×¡×˜×˜×™×¡×˜×™×§×•×ª:</strong> ×××•×¦×¢, ×¡×˜×™×™×ª ×ª×§×Ÿ, ×¨×•×•×— ×‘×˜×—×•×Ÿ</li>
     </ul>
    </div>
   </div>
  </div>
  <script>
        // ×§×‘×•×¢×™×
        const ROWS = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
        const ROW_COLORS = {
            'A': '#FF6B6B', 'B': '#4ECDC4', 'C': '#45B7D1', 'D': '#96CEB4',
            'E': '#FFEAA7', 'F': '#DDA0DD', 'G': '#98D8C8', 'H': '#F7DC6F'
        };

        // ××¦×‘ ×”××¢×¨×›×ª
        const state = {
            imageLoaded: false,
            gridVisible: true,
            selectedWells: new Set(),
            gridSettings: {
                x: 50,
                y: 50,
                spacingX: 60,
                spacingY: 60,
                wellSize: 35,
                ellipseRatioX: 1.0,
                ellipseRatioY: 1.0
            },
            // ××¦×‘ ×œ×”×©×•×•××•×ª ××•×ª×××•×ª
            comparisonGroups: {
                rowGroupA: new Set(),
                rowGroupB: new Set(),
                colGroupA: new Set(),
                colGroupB: new Set(),
                customGroupA: new Set(),
                customGroupB: new Set()
            }
        };

        // ××ª×—×•×œ ×”××¢×¨×›×ª
        document.addEventListener('DOMContentLoaded', function() {
            setupImageUpload();
            setupImageComponents();
        });

        // ×”×’×“×¨×ª ×”×¢×œ××ª ×ª××•× ×•×ª
        function setupImageUpload() {
            const fileInput = document.getElementById('fileInput');
            const uploadButton = document.getElementById('uploadButton');
            const uploadArea = document.getElementById('uploadArea');

            if (uploadButton && fileInput) {
                uploadButton.addEventListener('click', function() {
                    fileInput.click();
                });
            }

            if (fileInput) {
                fileInput.addEventListener('change', handleFileSelect);
            }
            
            if (uploadArea) {
                uploadArea.addEventListener('dragover', handleDragOver);
                uploadArea.addEventListener('dragleave', handleDragLeave);
                uploadArea.addEventListener('drop', handleDrop);
                
                uploadArea.addEventListener('click', function(e) {
                    if (e.target === uploadArea) {
                        fileInput.click();
                    }
                });
            }
        }

        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                loadImage(file);
                e.target.value = '';
            } else if (file) {
                alert('×× × ×‘×—×¨ ×§×•×‘×¥ ×ª××•× ×” ×ª×§×™×Ÿ (JPG, PNG, GIF ×•×›×•\')');
            }
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                loadImage(files[0]);
            }
        }

        function loadImage(file) {
            if (!file || !file.type.startsWith('image/')) {
                alert('×× × ×‘×—×¨ ×§×•×‘×¥ ×ª××•× ×” ×ª×§×™×Ÿ');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById('plateImage');
                if (!img) {
                    console.error('×œ× × ××¦× ××œ×× ×˜ ×”×ª××•× ×”');
                    return;
                }
                
                img.src = '';
                img.src = e.target.result;
                
                img.onload = function() {
                    state.imageLoaded = true;
                    const imageSection = document.getElementById('imageSection');
                    if (imageSection) {
                        imageSection.classList.remove('hidden');
                    }
                    
                    setTimeout(() => {
                        setupCanvas();
                        setTimeout(() => {
                            drawGrid();
                        }, 50);
                    }, 200);
                };
                
                img.onerror = function() {
                    alert('×©×’×™××” ×‘×˜×¢×™× ×ª ×”×ª××•× ×”. ×× × × ×¡×” ×ª××•× ×” ××—×¨×ª.');
                    state.imageLoaded = false;
                };
            };
            
            reader.onerror = function() {
                alert('×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥. ×× × × ×¡×” ×©×•×‘.');
            };
            
            reader.readAsDataURL(file);
        }

        // ×”×’×“×¨×ª ×¨×›×™×‘×™ ×”×ª××•× ×”
        function setupImageComponents() {
            createWellSelectionGrid();
            setupLongPressControls();
        }

        function setupCanvas() {
            const img = document.getElementById('plateImage');
            const canvas = document.getElementById('gridOverlay');
            const container = img.parentElement;
            
            if (!img || !canvas || !container) {
                console.error('×œ× × ××¦××• ××œ×× ×˜×™ ×”×ª××•× ×” ××• ×”×§× ×‘×¡');
                return;
            }

            if (img.offsetWidth === 0 || img.offsetHeight === 0) {
                setTimeout(setupCanvas, 50);
                return;
            }
            
            canvas.width = img.offsetWidth;
            canvas.height = img.offsetHeight;
            canvas.style.width = img.offsetWidth + 'px';
            canvas.style.height = img.offsetHeight + 'px';
            canvas.style.position = 'absolute';
            canvas.style.top = '0px';
            canvas.style.left = '0px';
            canvas.style.pointerEvents = 'none';
            canvas.style.zIndex = '10';
            
            console.log(`ğŸ“ ×”×’×“×¨×ª ×§× ×‘×¡: ${canvas.width}x${canvas.height} ×¤×™×§×¡×œ×™×`);
        }

        // ×¦×™×•×¨ ×”×¨×©×ª
        function drawGrid() {
            if (!state.imageLoaded || !state.gridVisible) return;

            const canvas = document.getElementById('gridOverlay');
            if (!canvas) {
                console.error('×œ× × ××¦× ××œ×× ×˜ ×”×§× ×‘×¡');
                return;
            }

            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error('×œ× × ×™×ª×Ÿ ×œ×§×‘×œ ×”×§×©×¨ ×©×œ ×”×§× ×‘×¡');
                return;
            }

            const { gridSettings } = state;
            const img = document.getElementById('plateImage');
            
            if (!img || img.offsetWidth === 0 || img.offsetHeight === 0) {
                console.error('×”×ª××•× ×” ×œ× × ×˜×¢× ×” ×›×¨××•×™');
                return;
            }

            try {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                for (let row = 0; row < 8; row++) {
                    for (let col = 0; col < 12; col++) {
                        const x = gridSettings.x + (col * gridSettings.spacingX);
                        const y = gridSettings.y + (row * gridSettings.spacingY);
                        
                        const wellId = ROWS[row] + (col + 1);
                        
                        if (x >= 0 && y >= 0 && x <= canvas.width && y <= canvas.height) {
                            ctx.beginPath();
                            ctx.arc(x, y, gridSettings.wellSize / 2, 0, 2 * Math.PI);
                            
                            ctx.strokeStyle = '#000000';
                            ctx.lineWidth = 1;
                            ctx.stroke();
                            
                            ctx.fillStyle = '#000000';
                            ctx.font = 'bold 11px Arial';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            ctx.fillText(wellId, x, y);
                        }
                    }
                }
            } catch (error) {
                console.error('×©×’×™××” ×‘×¦×™×•×¨ ×”×¨×©×ª:', error);
            }
        }

        // ××¢×¨×›×ª ×œ×—×™×¦×” ××¨×•×›×”
        const longPressState = {
            isPressed: false,
            currentAction: null,
            intervalId: null,
            timeoutId: null
        };

        // ×‘×§×¨×•×ª ×”×¨×©×ª
        function adjustGrid(direction) {
            const { gridSettings } = state;
            const step = 2;

            switch(direction) {
                case 'left': gridSettings.x -= step; break;
                case 'right': gridSettings.x += step; break;
                case 'up': gridSettings.y -= step; break;
                case 'down': gridSettings.y += step; break;
                case 'spacingXUp': gridSettings.spacingX += 1; break;
                case 'spacingXDown': gridSettings.spacingX = Math.max(20, gridSettings.spacingX - 1); break;
                case 'spacingYUp': gridSettings.spacingY += 1; break;
                case 'spacingYDown': gridSettings.spacingY = Math.max(20, gridSettings.spacingY - 1); break;
                case 'sizeUp': gridSettings.wellSize = Math.min(100, gridSettings.wellSize + 2); break;
                case 'sizeDown': gridSettings.wellSize = Math.max(20, gridSettings.wellSize - 2); break;
            }

            drawGrid();
        }

        function startLongPress(direction, button) {
            if (longPressState.isPressed) return;
            
            longPressState.isPressed = true;
            longPressState.currentAction = direction;
            
            adjustGrid(direction);
            
            button.style.transform = 'scale(0.95)';
            button.style.background = '#007bff';
            
            longPressState.timeoutId = setTimeout(() => {
                if (longPressState.isPressed) {
                    longPressState.intervalId = setInterval(() => {
                        if (longPressState.isPressed) {
                            adjustGrid(longPressState.currentAction);
                        }
                    }, 50);
                }
            }, 300);
        }

        function stopLongPress(button) {
            longPressState.isPressed = false;
            longPressState.currentAction = null;
            
            if (longPressState.timeoutId) {
                clearTimeout(longPressState.timeoutId);
                longPressState.timeoutId = null;
            }
            
            if (longPressState.intervalId) {
                clearInterval(longPressState.intervalId);
                longPressState.intervalId = null;
            }
            
            button.style.transform = '';
            button.style.background = '';
        }

        function setupLongPressControls() {
            const controlButtons = document.querySelectorAll('.grid-controls-sidebar .small-btn[data-action]');
            
            controlButtons.forEach(button => {
                const direction = button.getAttribute('data-action');
                if (!direction) return;
                
                button.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    startLongPress(direction, button);
                });
                
                button.addEventListener('mouseup', () => {
                    stopLongPress(button);
                });
                
                button.addEventListener('mouseleave', () => {
                    stopLongPress(button);
                });
                
                button.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    startLongPress(direction, button);
                });
                
                button.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    stopLongPress(button);
                });
                
                button.addEventListener('touchcancel', (e) => {
                    e.preventDefault();
                    stopLongPress(button);
                });
            });
        }

        function toggleGrid() {
            state.gridVisible = !state.gridVisible;
            const btn = document.getElementById('gridToggle');
            
            if (state.gridVisible) {
                btn.style.background = '#28a745';
                btn.textContent = 'ğŸ‘ï¸';
                drawGrid();
            } else {
                btn.style.background = '#6c757d';
                btn.textContent = 'ğŸ™ˆ';
                const canvas = document.getElementById('gridOverlay');
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
            }
        }

        // ×™×¦×™×¨×ª ×œ×•×— ×‘×—×™×¨×ª ×‘××¨×™×•×ª
        function createWellSelectionGrid() {
            const gridContainer = document.getElementById('wellSelectionGrid');
            if (!gridContainer) {
                console.error('×œ× × ××¦× ××œ×× ×˜ ×œ×•×— ×”×‘×—×™×¨×”');
                return;
            }
            
            try {
                gridContainer.innerHTML = '';
                
                for (let row = 0; row < 8; row++) {
                    for (let col = 1; col <= 12; col++) {
                        const wellId = ROWS[row] + col;
                        const wellButton = document.createElement('button');
                        
                        wellButton.className = 'well-button';
                        wellButton.textContent = wellId;
                        wellButton.type = 'button';
                        wellButton.setAttribute('data-well', wellId);
                        
                        wellButton.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            toggleWellSelection(wellId);
                        });
                        
                        gridContainer.appendChild(wellButton);
                    }
                }
                
                updateSelectedWellsList();
                updateAnalyzeButton();
            } catch (error) {
                console.error('×©×’×™××” ×‘×™×¦×™×¨×ª ×œ×•×— ×”×‘×—×™×¨×”:', error);
            }
        }

        function toggleWellSelection(wellId) {
            const wellButton = document.querySelector(`#wellSelectionGrid [data-well="${wellId}"]`);
            if (!wellButton) return;
            
            const { selectedWells } = state;
            if (selectedWells.has(wellId)) {
                selectedWells.delete(wellId);
                wellButton.classList.remove('selected');
            } else {
                selectedWells.add(wellId);
                wellButton.classList.add('selected');
            }
            
            updateSelectedWellsList();
            updateAnalyzeButton();
        }

        function updateSelectedWellsList() {
            const listContainer = document.getElementById('selectedWellsList');
            if (!listContainer) return;
            
            const { selectedWells } = state;
            
            if (selectedWells.size === 0) {
                listContainer.innerHTML = '<em style="color: #666;">×œ× × ×‘×—×¨×• ×‘××¨×™×•×ª ×¢×“×™×™×Ÿ</em>';
                return;
            }
            
            const sortedWells = Array.from(selectedWells).sort((a, b) => {
                const [rowA, colA] = [a.charAt(0), parseInt(a.substring(1))];
                const [rowB, colB] = [b.charAt(0), parseInt(b.substring(1))];
                return rowA !== rowB ? rowA.localeCompare(rowB) : colA - colB;
            });
            
            listContainer.innerHTML = sortedWells.map(well => 
                `<span style="background: #e3f2fd; padding: 2px 6px; margin: 2px; border-radius: 3px; display: inline-block;">${well}</span>`
            ).join('');
        }

        function updateAnalyzeButton() {
            const analyzeBtn = document.getElementById('analyzeBtn');
            if (!analyzeBtn) return;
            
            const { selectedWells } = state;
            const hasSelection = selectedWells.size > 0;
            
            if (hasSelection) {
                analyzeBtn.disabled = false;
                analyzeBtn.style.opacity = '1';
                analyzeBtn.textContent = `ğŸ”¬ × ×ª×— ${selectedWells.size} ×‘××¨×™×•×ª`;
            } else {
                analyzeBtn.disabled = true;
                analyzeBtn.style.opacity = '0.5';
                analyzeBtn.textContent = 'ğŸ”¬ × ×ª×— ×‘××¨×™×•×ª × ×‘×—×¨×•×ª';
            }
        }

        function updateWellButtons(wells, isSelected) {
            wells.forEach(wellId => {
                const wellButton = document.querySelector(`#wellSelectionGrid [data-well="${wellId}"]`);
                if (wellButton) {
                    wellButton.classList.toggle('selected', isSelected);
                }
            });
        }

        function selectAllWells() {
            const { selectedWells } = state;
            selectedWells.clear();
            
            for (let row = 0; row < 8; row++) {
                for (let col = 1; col <= 12; col++) {
                    selectedWells.add(ROWS[row] + col);
                }
            }
            
            document.querySelectorAll('#wellSelectionGrid .well-button')
                .forEach(button => button.classList.add('selected'));
            
            updateSelectedWellsList();
            updateAnalyzeButton();
        }

        function clearAllWells() {
            const { selectedWells } = state;
            selectedWells.clear();
            
            document.querySelectorAll('#wellSelectionGrid .well-button')
                .forEach(button => button.classList.remove('selected'));
            
            updateSelectedWellsList();
            updateAnalyzeButton();
        }

        function selectRow(row) {
            const { selectedWells } = state;
            const rowWells = Array.from({length: 12}, (_, i) => row + (i + 1));
            const allSelected = rowWells.every(wellId => selectedWells.has(wellId));
            
            if (allSelected) {
                rowWells.forEach(wellId => selectedWells.delete(wellId));
                updateWellButtons(rowWells, false);
            } else {
                rowWells.forEach(wellId => selectedWells.add(wellId));
                updateWellButtons(rowWells, true);
            }
            
            updateSelectedWellsList();
            updateAnalyzeButton();
        }

        function selectColumn(col) {
            const { selectedWells } = state;
            const colWells = ROWS.map(row => row + col);
            const allSelected = colWells.every(wellId => selectedWells.has(wellId));
            
            if (allSelected) {
                colWells.forEach(wellId => selectedWells.delete(wellId));
                updateWellButtons(colWells, false);
            } else {
                colWells.forEach(wellId => selectedWells.add(wellId));
                updateWellButtons(colWells, true);
            }
            
            updateSelectedWellsList();
            updateAnalyzeButton();
        }

        function selectRange(startWell, endWell) {
            const { selectedWells } = state;
            const [startRow, startCol] = [startWell.charAt(0), parseInt(startWell.substring(1))];
            const [endRow, endCol] = [endWell.charAt(0), parseInt(endWell.substring(1))];
            
            const startRowIndex = startRow.charCodeAt(0) - 'A'.charCodeAt(0);
            const endRowIndex = endRow.charCodeAt(0) - 'A'.charCodeAt(0);
            
            const rangeWells = [];
            for (let rowIndex = startRowIndex; rowIndex <= endRowIndex; rowIndex++) {
                const row = String.fromCharCode('A'.charCodeAt(0) + rowIndex);
                for (let col = startCol; col <= endCol; col++) {
                    rangeWells.push(row + col);
                }
            }
            
            const allSelected = rangeWells.every(wellId => selectedWells.has(wellId));
            
            if (allSelected) {
                rangeWells.forEach(wellId => selectedWells.delete(wellId));
                updateWellButtons(rangeWells, false);
            } else {
                rangeWells.forEach(wellId => selectedWells.add(wellId));
                updateWellButtons(rangeWells, true);
            }
            
            updateSelectedWellsList();
            updateAnalyzeButton();
        }

        // × ×™×ª×•×— HSV ×©×œ ×”×‘××¨×™×•×ª ×”× ×‘×—×¨×•×ª
        function analyzeSelectedWells() {
            const { imageLoaded, selectedWells, gridSettings } = state;
            
            if (!imageLoaded) {
                alert('×× × ×”×¢×œ×” ×ª××•× ×” ×ª×—×™×œ×”');
                return;
            }
            
            if (selectedWells.size === 0) {
                alert('×× × ×‘×—×¨ ×œ×¤×—×•×ª ×‘××¨×™×ª ××—×ª ×œ× ×™×ª×•×—');
                return;
            }

            const img = document.getElementById('plateImage');
            if (!img || !img.complete || !img.naturalWidth || !img.naturalHeight) {
                alert('×”×ª××•× ×” ×œ× × ×˜×¢× ×” ×›×¨××•×™. ×× × × ×¡×” ×©×•×‘.');
                return;
            }

            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                if (!ctx) {
                    throw new Error('×œ× × ×™×ª×Ÿ ×œ×™×¦×•×¨ ×”×§×©×¨ ×§× ×‘×¡ ×œ× ×™×ª×•×—');
                }
                
                canvas.width = img.naturalWidth;
                canvas.height = img.naturalHeight;
                ctx.drawImage(img, 0, 0);

                const scaleX = img.naturalWidth / (img.offsetWidth || 1);
                const scaleY = img.naturalHeight / (img.offsetHeight || 1);
                
                console.log(`ğŸ“ ×™×—×¡ ×§× ×” ××™×“×”: ${scaleX.toFixed(2)}x${scaleY.toFixed(2)} (×ª××•× ×” ×××™×ª×™×ª: ${img.naturalWidth}x${img.naturalHeight}, ××•×¦×’×ª: ${img.offsetWidth}x${img.offsetHeight})`);

                const results = Array.from(selectedWells).map(wellId => {
                    const row = wellId.charAt(0);
                    const col = parseInt(wellId.substring(1)) - 1;
                    const rowIndex = row.charCodeAt(0) - 'A'.charCodeAt(0);
                    
                    const gridX = gridSettings.x + (col * gridSettings.spacingX);
                    const gridY = gridSettings.y + (rowIndex * gridSettings.spacingY);
                    
                    const realX = gridX * scaleX;
                    const realY = gridY * scaleY;
                    
                    const realRadiusX = (gridSettings.wellSize / 2) * gridSettings.ellipseRatioX * scaleX;
                    const realRadiusY = (gridSettings.wellSize / 2) * gridSettings.ellipseRatioY * scaleY;
                    
                    console.log(`ğŸ”¬ ×× ×ª×— ×‘××¨×™×ª ${wellId}:`);
                    console.log(`   ××™×§×•× ×¨×©×ª: (${gridX.toFixed(1)}, ${gridY.toFixed(1)})`);
                    console.log(`   ××™×§×•× ×ª××•× ×” ×××™×ª×™×ª: (${realX.toFixed(1)}, ${realY.toFixed(1)})`);
                    console.log(`   ×¨×“×™×•×¡ ×××™×ª×™: ${realRadiusX.toFixed(1)}x${realRadiusY.toFixed(1)}`);
                    
                    const hsvIntensity = getHSVColorIntensity(ctx, realX, realY, Math.max(realRadiusX, realRadiusY), realRadiusX, realRadiusY);
                    
                    return {
                        well: wellId,
                        colorStrength: hsvIntensity,
                        intensity: hsvIntensity
                    };
                });

                results.sort((a, b) => {
                    const [rowA, colA] = [a.well.charAt(0), parseInt(a.well.substring(1))];
                    const [rowB, colB] = [b.well.charAt(0), parseInt(b.well.substring(1))];
                    return rowA !== rowB ? rowA.localeCompare(rowB) : colA - colB;
                });

                window.lastAnalysisResults = results;
                displayResults(results);
                performAutomaticStatisticalAnalysis(results);
                initializeComparisonSelectors(results);
                
                console.log('× ×™×ª×•×— HSV ×”×•×©×œ× ×‘×”×¦×œ×—×”:', results.length, '×‘××¨×™×•×ª');
            } catch (error) {
                console.error('×©×’×™××” ×‘× ×™×ª×•×—:', error);
                alert('×©×’×™××” ×‘× ×™×ª×•×— ×”×ª××•× ×”: ' + error.message + '. ×× × × ×¡×” ×©×•×‘ ××• ×‘×—×¨ ×ª××•× ×” ××—×¨×ª.');
            }
        }

        // × ×™×ª×•×— HSV ××ª×§×“×
        function getHSVColorIntensity(ctx, x, y, maxRadius, radiusX, radiusY) {
            try {
                console.log(`ğŸ¨ ××•×“×“ ×¢×•×¦××ª ×¦×‘×¢ HSV ×‘×‘××¨×™×ª ×‘××™×§×•× (${x.toFixed(1)}, ${y.toFixed(1)}) ×¢× ×¨×“×™×•×¡ ${radiusX.toFixed(1)}x${radiusY.toFixed(1)}`);
                
                let sampledPixels = 0;
                let totalSaturation = 0;
                let totalValue = 0;
                let hsvValues = [];
                
                const sampleRange = Math.max(radiusX, radiusY) * 0.7;
                
                for (let dy = -sampleRange; dy <= sampleRange; dy += 0.5) {
                    for (let dx = -sampleRange; dx <= sampleRange; dx += 0.5) {
                        const ellipseTest = (dx*dx)/(radiusX*radiusX) + (dy*dy)/(radiusY*radiusY);
                        
                        if (ellipseTest <= 0.49) {
                            const pixelX = Math.round(x + dx);
                            const pixelY = Math.round(y + dy);
                            
                            if (pixelX >= 0 && pixelY >= 0 && pixelX < ctx.canvas.width && pixelY < ctx.canvas.height) {
                                try {
                                    const imageData = ctx.getImageData(pixelX, pixelY, 1, 1);
                                    const [r, g, b, a] = imageData.data;
                                    
                                    if (a > 200 && r >= 0 && g >= 0 && b >= 0 && r <= 255 && g <= 255 && b <= 255) {
                                        const hsv = rgbToHsv(r, g, b);
                                        
                                        hsvValues.push(hsv);
                                        totalSaturation += hsv.s;
                                        totalValue += hsv.v;
                                        sampledPixels++;
                                    }
                                } catch(e) {
                                    // ×¤×™×§×¡×œ ×œ× × ×’×™×©
                                }
                            }
                        }
                    }
                }
                
                console.log(`ğŸ“Š × ×“×’××• ${sampledPixels} ×¤×™×§×¡×œ×™× ×‘××¨×›×– ×”×‘××¨×™×ª`);
                
                if (sampledPixels === 0) {
                    console.log('âš ï¸ ×œ× × ××¦××• ×¤×™×§×¡×œ×™× ×ª×§×™× ×™× ×‘×‘××¨×™×ª');
                    return 0;
                }
                
                const avgSaturation = totalSaturation / sampledPixels;
                const avgValue = totalValue / sampledPixels;
                
                const colorStrength = avgSaturation * (1 - avgValue);
                
                console.log(`ğŸ¨ ×××•×¦×¢ Saturation: ${avgSaturation.toFixed(3)} (0-1)`);
                console.log(`ğŸ’¡ ×××•×¦×¢ Value: ${avgValue.toFixed(3)} (0-1)`);
                console.log(`ğŸ”¥ ×¢×•×¦××ª ×¦×‘×¢: ${colorStrength.toFixed(3)} (0-1)`);
                
                return Math.round(colorStrength * 1000) / 1000;
                
            } catch (error) {
                console.log('×©×’×™××” ×‘××“×™×“×ª ×¢×•×¦××ª ×¦×‘×¢ HSV:', error.message);
                return 0;
            }
        }

        function rgbToHsv(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const diff = max - min;

            let h = 0;
            let s = 0;
            const v = max;

            if (max !== 0) {
                s = diff / max;
            }

            if (diff !== 0) {
                switch (max) {
                    case r:
                        h = ((g - b) / diff + (g < b ? 6 : 0)) / 6;
                        break;
                    case g:
                        h = ((b - r) / diff + 2) / 6;
                        break;
                    case b:
                        h = ((r - g) / diff + 4) / 6;
                        break;
                }
            }

            return { h, s, v };
        }

        // ×”×¦×’×ª ×ª×•×¦××•×ª
        function displayResults(results) {
            const tbody = document.getElementById('resultsBody');
            const thead = document.querySelector('#resultsTable thead tr');
            if (!tbody || !thead) {
                console.error('×œ× × ××¦××• ××œ×× ×˜×™ ×”×˜×‘×œ×”');
                return;
            }

            if (!results || results.length === 0) {
                console.error('××™×Ÿ ×ª×•×¦××•×ª ×œ×”×¦×’×”');
                return;
            }
            
            tbody.innerHTML = '';
            thead.innerHTML = '';

            const plateData = {};
            const allColumns = new Set();
            
            results.forEach(result => {
                const row = result.well.charAt(0);
                const col = parseInt(result.well.substring(1));
                
                if (!plateData[row]) plateData[row] = {};
                plateData[row][col] = result;
                allColumns.add(col);
            });

            const sortedColumns = Array.from(allColumns).sort((a, b) => a - b);

            const headerRow = thead;
            headerRow.innerHTML = '<th style="background: #4facfe; color: white; padding: 12px; text-align: center;">×©×•×¨×”</th>';
            
            sortedColumns.forEach(col => {
                const th = document.createElement('th');
                th.style.cssText = 'background: #4facfe; color: white; padding: 12px; text-align: center; min-width: 80px;';
                th.textContent = col.toString();
                headerRow.appendChild(th);
            });

            const allValues = results.map(r => r.colorStrength);
            const minValue = Math.min(...allValues);
            const maxValue = Math.max(...allValues);
            const range = maxValue - minValue || 1;

            ROWS.forEach(rowLetter => {
                if (!plateData[rowLetter]) return;
                
                const tr = document.createElement('tr');
                
                const rowHeader = document.createElement('td');
                rowHeader.style.cssText = `background: ${ROW_COLORS[rowLetter] || '#666'}; color: white; font-weight: bold; text-align: center; padding: 12px;`;
                rowHeader.textContent = rowLetter;
                tr.appendChild(rowHeader);
                
                sortedColumns.forEach(col => {
                    const td = document.createElement('td');
                    td.style.cssText = 'padding: 8px; text-align: center; border: 1px solid #ddd; font-size: 12px;';
                    
                    const result = plateData[rowLetter][col];
                    if (result) {
                        const normalizedValue = (result.colorStrength - minValue) / range;
                        
                        const intensity = Math.round(normalizedValue * 200);
                        const bgColor = `rgb(${255 - intensity * 2}, ${255 - intensity * 2}, ${255 - intensity})`;
                        const textColor = normalizedValue > 0.5 ? 'white' : 'black';
                        
                        td.style.background = bgColor;
                        td.style.color = textColor;
                        td.style.fontWeight = 'bold';
                        
                        let tooltipText = `×‘××¨×™×ª: ${result.well}\n×¢×•×¦××ª ×¦×‘×¢: ${result.colorStrength.toFixed(3)}`;
                        td.title = tooltipText;
                        
                        td.innerHTML = `
                            <div style="font-size: 10px; opacity: 0.8; margin-bottom: 2px;">${result.well}</div>
                            <div style="font-size: 12px; font-weight: bold;">${result.colorStrength.toFixed(3)}</div>
                            <div style="font-size: 8px; opacity: 0.9;">×¢×•×¦××ª ×¦×‘×¢</div>
                        `;
                    } else {
                        td.style.background = '#f5f5f5';
                        td.style.color = '#999';
                        td.textContent = '-';
                    }
                    
                    tr.appendChild(td);
                });
                
                tbody.appendChild(tr);
            });

            drawChart(results);
            document.getElementById('resultsSection').classList.remove('hidden');
        }

        // ×™×¦×™×¨×ª ×’×¨×£
        function drawChart(results) {
            const canvas = document.getElementById('intensityChart');
            if (!canvas) {
                console.error('×œ× × ××¦× ××œ×× ×˜ ×”×’×¨×£');
                return;
            }

            if (!results || results.length === 0) {
                console.error('××™×Ÿ ×ª×•×¦××•×ª ×œ×’×¨×£');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            const tooltip = document.getElementById('chartTooltip');
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (results.length === 0) return;
            
            const padding = 80;
            const chartWidth = canvas.width - (padding * 2);
            const chartHeight = canvas.height - (padding * 2);
            
            const values = results.map(r => r.colorStrength);
            const minValue = Math.min(...values);
            const maxValue = Math.max(...values);
            const range = maxValue - minValue || 1;
            
            const rowData = {};
            results.forEach(result => {
                const row = result.well.charAt(0);
                if (!rowData[row]) rowData[row] = [];
                rowData[row].push(result);
            });
            
            Object.values(rowData).forEach(rowResults => {
                rowResults.sort((a, b) => parseInt(a.well.substring(1)) - parseInt(b.well.substring(1)));
            });
            
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(padding, padding, chartWidth, chartHeight);
            
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            
            for (let i = 0; i <= 10; i++) {
                const y = padding + (chartHeight * i / 10);
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(padding + chartWidth, y);
                ctx.stroke();
                
                const value = maxValue - (range * i / 10);
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.textAlign = 'right';
                const displayText = value.toFixed(3);
                ctx.fillText(displayText, padding - 10, y + 4);
            }
            
            const maxCols = Math.max(...results.map(r => parseInt(r.well.substring(1))));
            for (let col = 1; col <= maxCols; col++) {
                const x = padding + ((col - 1) / (maxCols - 1)) * chartWidth;
                ctx.beginPath();
                ctx.moveTo(x, padding);
                ctx.lineTo(x, padding + chartHeight);
                ctx.stroke();
                
                ctx.fillStyle = '#666';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(col.toString(), x, padding + chartHeight + 20);
            }
            
            const allPoints = [];
            
            Object.entries(rowData).forEach(([row, rowResults]) => {
                if (rowResults.length === 0) return;
                
                const color = ROW_COLORS[row] || '#666';
                
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                const rowPoints = rowResults.map((result, index) => {
                    const col = parseInt(result.well.substring(1));
                    const x = padding + ((col - 1) / (maxCols - 1)) * chartWidth;
                    
                    const displayValue = result.colorStrength;
                    const y = padding + chartHeight - ((displayValue - minValue) / range * chartHeight);
                    
                    const point = { x, y, result, color, displayValue };
                    allPoints.push(point);
                    
                    if (index === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                    
                    return point;
                });
                
                ctx.stroke();
                
                rowPoints.forEach(point => {
                    ctx.fillStyle = point.color;
                    ctx.beginPath();
                    ctx.arc(point.x, point.y, 6, 0, 2 * Math.PI);
                    ctx.fill();
                    
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                });
            });
            
            allPoints.forEach(point => {
                ctx.fillStyle = '#333';
                ctx.font = 'bold 10px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(point.result.well, point.x, point.y - 12);
            });
            
            const legendX = padding + chartWidth - 120;
            const legendY = padding + 20;
            const legendHeight = Object.keys(rowData).length * 20 + 20;
            
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fillRect(legendX - 10, legendY - 10, 110, legendHeight);
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            ctx.strokeRect(legendX - 10, legendY - 10, 110, legendHeight);
            
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('×©×•×¨×•×ª:', legendX, legendY + 5);
            
            Object.entries(rowData).forEach(([row, rowResults], index) => {
                const y = legendY + 20 + (index * 18);
                
                ctx.fillStyle = ROW_COLORS[row];
                ctx.fillRect(legendX, y - 8, 12, 12);
                
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.fillText(`×©×•×¨×” ${row} (${rowResults.length} ×‘××¨×™×•×ª)`, legendX + 18, y + 2);
            });
            
            ctx.fillStyle = '#333';
            ctx.font = 'bold 14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('××¡×¤×¨ ×¢××•×“×”', canvas.width / 2, canvas.height - 10);
            
            ctx.save();
            ctx.translate(20, canvas.height / 2);
            ctx.rotate(-Math.PI / 2);
            ctx.fillText('×¢×•×¦××ª ×¦×‘×¢ (0-1)', 0, 0);
            ctx.restore();
            
            canvas.onmousemove = function(e) {
                const rect = canvas.getBoundingClientRect();
                const scaleX = canvas.width / rect.width;
                const scaleY = canvas.height / rect.height;
                const scaledX = (e.clientX - rect.left) * scaleX;
                const scaledY = (e.clientY - rect.top) * scaleY;
                
                const foundPoint = allPoints.find(point => {
                    const distance = Math.sqrt(Math.pow(scaledX - point.x, 2) + Math.pow(scaledY - point.y, 2));
                    return distance <= 15;
                });
                
                if (foundPoint && tooltip) {
                    tooltip.style.display = 'block';
                    tooltip.style.left = (e.clientX + 10) + 'px';
                    tooltip.style.top = (e.clientY - 10) + 'px';
                    tooltip.innerHTML = `
                        <strong>×‘××¨×™×ª: ${foundPoint.result.well}</strong><br>
                        ×©×•×¨×”: ${foundPoint.result.well.charAt(0)}<br>
                        ×¢××•×“×”: ${foundPoint.result.well.substring(1)}<br>
                        ×¢×•×¦××ª ×¦×‘×¢: ${foundPoint.result.colorStrength.toFixed(3)}
                    `;
                    canvas.style.cursor = 'pointer';
                } else {
                    if (tooltip) tooltip.style.display = 'none';
                    canvas.style.cursor = 'crosshair';
                }
            };
            
            canvas.onmouseleave = () => {
                if (tooltip) tooltip.style.display = 'none';
                canvas.style.cursor = 'crosshair';
            };
        }

        // ×¤×•× ×§×¦×™×•×ª ×¡×˜×˜×™×¡×˜×™×•×ª
        function calculateBasicStats(values) {
            const n = values.length;
            const mean = values.reduce((sum, val) => sum + val, 0) / n;
            const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / (n - 1);
            const std = Math.sqrt(variance);
            const min = Math.min(...values);
            const max = Math.max(...values);
            
            const tValue = getTValue(n - 1, 0.05);
            const marginOfError = tValue * (std / Math.sqrt(n));
            const confidenceInterval = [mean - marginOfError, mean + marginOfError];
            
            return {
                n,
                mean,
                std,
                variance,
                min,
                max,
                confidenceInterval
            };
        }

        function performTTest(group1, group2) {
            const stats1 = calculateBasicStats(group1);
            const stats2 = calculateBasicStats(group2);
            
            const pooledStd = Math.sqrt((stats1.variance / stats1.n) + (stats2.variance / stats2.n));
            const tStatistic = (stats1.mean - stats2.mean) / pooledStd;
            
            const numerator = Math.pow((stats1.variance / stats1.n) + (stats2.variance / stats2.n), 2);
            const denominator = (Math.pow(stats1.variance / stats1.n, 2) / (stats1.n - 1)) + 
                              (Math.pow(stats2.variance / stats2.n, 2) / (stats2.n - 1));
            const degreesOfFreedom = numerator / denominator;
            
            const pValue = calculatePValue(Math.abs(tStatistic), degreesOfFreedom);
            
            return {
                tStatistic,
                degreesOfFreedom,
                pValue,
                significant: pValue < 0.05
            };
        }

        function getTValue(df, alpha) {
            const tTable = {
                1: 12.706, 2: 4.303, 3: 3.182, 4: 2.776, 5: 2.571,
                6: 2.447, 7: 2.365, 8: 2.306, 9: 2.262, 10: 2.228,
                15: 2.131, 20: 2.086, 25: 2.060, 30: 2.042, 40: 2.021,
                60: 2.000, 120: 1.980
            };
            
            if (df <= 120) {
                for (let key of Object.keys(tTable).map(Number).sort((a, b) => a - b)) {
                    if (df <= key) return tTable[key];
                }
            }
            return 1.96;
        }

        function calculatePValue(tStat, df) {
            const absTStat = Math.abs(tStat);
            
            if (df <= 1) {
                if (absTStat < 1) return 0.5;
                if (absTStat < 3.08) return 0.2;
                if (absTStat < 6.31) return 0.1;
                if (absTStat < 12.71) return 0.05;
                if (absTStat < 31.82) return 0.02;
                if (absTStat < 63.66) return 0.01;
                return 0.001;
            } else if (df <= 5) {
                if (absTStat < 1) return 0.4;
                if (absTStat < 1.48) return 0.2;
                if (absTStat < 2.02) return 0.1;
                if (absTStat < 2.57) return 0.05;
                if (absTStat < 3.36) return 0.02;
                if (absTStat < 4.03) return 0.01;
                if (absTStat < 5.89) return 0.001;
                return 0.0001;
            } else if (df <= 10) {
                if (absTStat < 1) return 0.35;
                if (absTStat < 1.37) return 0.2;
                if (absTStat < 1.81) return 0.1;
                if (absTStat < 2.23) return 0.05;
                if (absTStat < 2.76) return 0.02;
                if (absTStat < 3.17) return 0.01;
                if (absTStat < 4.14) return 0.001;
                return 0.0001;
            } else {
                if (absTStat < 1) return 0.32;
                if (absTStat < 1.28) return 0.2;
                if (absTStat < 1.64) return 0.1;
                if (absTStat < 1.96) return 0.05;
                if (absTStat < 2.33) return 0.02;
                if (absTStat < 2.58) return 0.01;
                if (absTStat < 3.29) return 0.001;
                return 0.0001;
            }
        }

        // × ×™×ª×•×— ×¡×˜×˜×™×¡×˜×™ ××•×˜×•××˜×™
        function performAutomaticStatisticalAnalysis(results) {
            console.log('ğŸ¤– ××ª×—×™×œ × ×™×ª×•×— ×¡×˜×˜×™×¡×˜×™ ××•×˜×•××˜×™...');
            console.log(`ğŸ“Š ×× ×ª×— ${results.length} ×‘××¨×™×•×ª`);
            
            const availableRows = new Set();
            const availableColumns = new Set();
            
            results.forEach(result => {
                const row = result.well.charAt(0);
                const col = parseInt(result.well.substring(1));
                availableRows.add(row);
                availableColumns.add(col);
            });
            
            console.log(`ğŸ“‹ ×©×•×¨×•×ª ×–××™× ×•×ª: ${Array.from(availableRows).sort().join(', ')}`);
            console.log(`ğŸ“‹ ×¢××•×“×•×ª ×–××™× ×•×ª: ${Array.from(availableColumns).sort((a,b) => a-b).join(', ')}`);
            
            const significantComparisons = [];
            let totalRowComparisons = 0;
            let totalColComparisons = 0;
            
            const rowsArray = Array.from(availableRows).sort();
            console.log(`ğŸ”¸ ×‘×•×“×§ ×”×©×•×•××•×ª ×‘×™×Ÿ ×©×•×¨×•×ª...`);
            
            for (let i = 0; i < rowsArray.length; i++) {
                for (let j = i + 1; j < rowsArray.length; j++) {
                    const row1 = rowsArray[i];
                    const row2 = rowsArray[j];
                    
                    const row1Data = results.filter(r => r.well.charAt(0) === row1);
                    const row2Data = results.filter(r => r.well.charAt(0) === row2);
                    
                    console.log(`   ×”×©×•×•××”: ×©×•×¨×” ${row1} (${row1Data.length} ×‘××¨×™×•×ª) vs ×©×•×¨×” ${row2} (${row2Data.length} ×‘××¨×™×•×ª)`);
                    
                    if (row1Data.length >= 1 && row2Data.length >= 1) {
                        totalRowComparisons++;
                        
                        const row1Values = row1Data.map(r => r.colorStrength);
                        const row2Values = row2Data.map(r => r.colorStrength);
                        
                        console.log(`      ×©×•×¨×” ${row1} ×¢×¨×›×™×:`, row1Values.map(v => v.toFixed(3)));
                        console.log(`      ×©×•×¨×” ${row2} ×¢×¨×›×™×:`, row2Values.map(v => v.toFixed(3)));
                        
                        const stats1 = calculateBasicStats(row1Values);
                        const stats2 = calculateBasicStats(row2Values);
                        const tTest = performTTest(row1Values, row2Values);
                        
                        console.log(`      ×××•×¦×¢ ×©×•×¨×” ${row1}: ${stats1.mean.toFixed(4)}, ×××•×¦×¢ ×©×•×¨×” ${row2}: ${stats2.mean.toFixed(4)}`);
                        console.log(`      t-statistic: ${tTest.tStatistic.toFixed(3)}, p-value: ${tTest.pValue.toFixed(4)}, ××•×‘×”×§: ${tTest.significant}`);
                        
                        if (tTest.significant) {
                            significantComparisons.push({
                                type: '×©×•×¨×•×ª',
                                name1: `×©×•×¨×” ${row1}`,
                                name2: `×©×•×¨×” ${row2}`,
                                stats1,
                                stats2,
                                tTest
                            });
                            console.log(`      âœ… ×”×‘×“×œ ××•×‘×”×§ × ××¦×!`);
                        } else {
                            console.log(`      âŒ ××™×Ÿ ×”×‘×“×œ ××•×‘×”×§`);
                        }
                    } else {
                        console.log(`      âš ï¸ ×œ× ××¡×¤×™×§ × ×ª×•× ×™× ×œ×”×©×•×•××”`);
                    }
                }
            }
            
            const columnsArray = Array.from(availableColumns).sort((a, b) => a - b);
            console.log(`ğŸ”¹ ×‘×•×“×§ ×”×©×•×•××•×ª ×‘×™×Ÿ ×¢××•×“×•×ª...`);
            
            for (let i = 0; i < columnsArray.length; i++) {
                for (let j = i + 1; j < columnsArray.length; j++) {
                    const col1 = columnsArray[i];
                    const col2 = columnsArray[j];
                    
                    const col1Data = results.filter(r => parseInt(r.well.substring(1)) === col1);
                    const col2Data = results.filter(r => parseInt(r.well.substring(1)) === col2);
                    
                    console.log(`   ×”×©×•×•××”: ×¢××•×“×” ${col1} (${col1Data.length} ×‘××¨×™×•×ª) vs ×¢××•×“×” ${col2} (${col2Data.length} ×‘××¨×™×•×ª)`);
                    
                    if (col1Data.length >= 1 && col2Data.length >= 1) {
                        totalColComparisons++;
                        
                        const col1Values = col1Data.map(r => r.colorStrength);
                        const col2Values = col2Data.map(r => r.colorStrength);
                        
                        console.log(`      ×¢××•×“×” ${col1} ×¢×¨×›×™×:`, col1Values.map(v => v.toFixed(3)));
                        console.log(`      ×¢××•×“×” ${col2} ×¢×¨×›×™×:`, col2Values.map(v => v.toFixed(3)));
                        
                        const stats1 = calculateBasicStats(col1Values);
                        const stats2 = calculateBasicStats(col2Values);
                        const tTest = performTTest(col1Values, col2Values);
                        
                        console.log(`      ×××•×¦×¢ ×¢××•×“×” ${col1}: ${stats1.mean.toFixed(4)}, ×××•×¦×¢ ×¢××•×“×” ${col2}: ${stats2.mean.toFixed(4)}`);
                        console.log(`      t-statistic: ${tTest.tStatistic.toFixed(3)}, p-value: ${tTest.pValue.toFixed(4)}, ××•×‘×”×§: ${tTest.significant}`);
                        
                        if (tTest.significant) {
                            significantComparisons.push({
                                type: '×¢××•×“×•×ª',
                                name1: `×¢××•×“×” ${col1}`,
                                name2: `×¢××•×“×” ${col2}`,
                                stats1,
                                stats2,
                                tTest
                            });
                            console.log(`      âœ… ×”×‘×“×œ ××•×‘×”×§ × ××¦×!`);
                        } else {
                            console.log(`      âŒ ××™×Ÿ ×”×‘×“×œ ××•×‘×”×§`);
                        }
                    } else {
                        console.log(`      âš ï¸ ×œ× ××¡×¤×™×§ × ×ª×•× ×™× ×œ×”×©×•×•××”`);
                    }
                }
            }
            
            console.log(`ğŸ“ˆ ×¡×™×›×•×: × ×‘×“×§×• ${totalRowComparisons} ×”×©×•×•××•×ª ×©×•×¨×•×ª ×•-${totalColComparisons} ×”×©×•×•××•×ª ×¢××•×“×•×ª`);
            console.log(`ğŸ¯ × ××¦××• ${significantComparisons.length} ×”×‘×“×œ×™× ××•×‘×”×§×™× ×¡×˜×˜×™×¡×˜×™×ª`);
            
            displayAutomaticStatisticalResults(significantComparisons, totalRowComparisons, totalColComparisons);
        }

        function displayAutomaticStatisticalResults(significantComparisons, totalRowComparisons = 0, totalColComparisons = 0) {
            const contentDiv = document.getElementById('statisticalContent');
            
            if (!contentDiv) return;
            
            if (significantComparisons.length === 0) {
                contentDiv.innerHTML = `
                    <div style="text-align: center; padding: 30px; background: #f8f9fa; border-radius: 8px; border: 2px dashed #28a745;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸŸ¢</div>
                        <h5 style="color: #28a745; margin-bottom: 10px;">××™×Ÿ ×”×‘×“×œ×™× ××•×‘×”×§×™× ×¡×˜×˜×™×¡×˜×™×ª</h5>
                        <p style="color: #666; font-size: 14px; margin: 0;">
                            × ×‘×“×§×• ${totalRowComparisons} ×”×©×•×•××•×ª ×‘×™×Ÿ ×©×•×¨×•×ª ×•-${totalColComparisons} ×”×©×•×•××•×ª ×‘×™×Ÿ ×¢××•×“×•×ª.<br>
                            ×œ× × ××¦××• ×”×‘×“×œ×™× ××•×‘×”×§×™× ×¡×˜×˜×™×¡×˜×™×ª (p < 0.05).<br>
                            ×›×œ ×”×”×©×•×•××•×ª ××¨××•×ª ×¢×œ ×“××™×•×Ÿ ×¡×˜×˜×™×¡×˜×™.
                        </p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 20px; text-align: center;">
                    <div style="font-size: 24px; margin-bottom: 10px;">ğŸ”</div>
                    <h5 style="color: #856404; margin-bottom: 8px;">× ××¦××• ${significantComparisons.length} ×”×‘×“×œ×™× ××•×‘×”×§×™× ×¡×˜×˜×™×¡×˜×™×ª!</h5>
                    <p style="color: #856404; font-size: 13px; margin: 0;">
                        × ×‘×“×§×• ${totalRowComparisons} ×”×©×•×•××•×ª ×‘×™×Ÿ ×©×•×¨×•×ª ×•-${totalColComparisons} ×”×©×•×•××•×ª ×‘×™×Ÿ ×¢××•×“×•×ª<br>
                        ××¦×™×’ ×¨×§ ×”×‘×“×œ×™× ××•×‘×”×§×™× (p < 0.05)
                    </p>
                </div>
            `;
            
            const rowComparisons = significantComparisons.filter(c => c.type === '×©×•×¨×•×ª');
            const colComparisons = significantComparisons.filter(c => c.type === '×¢××•×“×•×ª');
            
            if (rowComparisons.length > 0) {
                html += `
                    <div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                        <h6 style="color: #2e7d32; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            ğŸ”¸ ×”×‘×“×œ×™× ××•×‘×”×§×™× ×‘×™×Ÿ ×©×•×¨×•×ª (${rowComparisons.length})
                        </h6>
                        <div style="display: grid; gap: 10px;">
                `;
                
                rowComparisons.forEach((comp, index) => {
                    html += createComparisonCard(comp, index);
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            if (colComparisons.length > 0) {
                html += `
                    <div style="background: #e3f2fd; border: 1px solid #2196f3; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                        <h6 style="color: #1976d2; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                            ğŸ”¹ ×”×‘×“×œ×™× ××•×‘×”×§×™× ×‘×™×Ÿ ×¢××•×“×•×ª (${colComparisons.length})
                        </h6>
                        <div style="display: grid; gap: 10px;">
                `;
                
                colComparisons.forEach((comp, index) => {
                    html += createComparisonCard(comp, index + rowComparisons.length);
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            html += `
                <div style="background: #f0f9ff; border: 1px solid #4facfe; border-radius: 8px; padding: 12px; margin-top: 15px;">
                    <div style="font-size: 12px; color: #1976d2; text-align: center;">
                        <strong>ğŸ’¡ ×”×¡×‘×¨:</strong> ×‘×“×™×§×ª t-test ××©×•×•×” ×‘×™×Ÿ ×××•×¦×¢×™ ×”×§×‘×•×¦×•×ª. 
                        p-value < 0.05 ××¢×™×“ ×¢×œ ×”×‘×“×œ ××•×‘×”×§ ×¡×˜×˜×™×¡×˜×™×ª ×‘×¨××ª ××•×‘×”×§×•×ª ×©×œ 95%.
                        ×›×›×œ ×©×”-p-value × ××•×š ×™×•×ª×¨, ×”×”×‘×“×œ ××•×‘×”×§ ×™×•×ª×¨.
                    </div>
                </div>
            `;
            
            contentDiv.innerHTML = html;
            
            console.log(`ğŸ“Š ×”×•×¦×’×• ${significantComparisons.length} ×”×‘×“×œ×™× ××•×‘×”×§×™× ×¡×˜×˜×™×¡×˜×™×ª`);
        }
        
        function createComparisonCard(comparison, index) {
            const { name1, name2, stats1, stats2, tTest } = comparison;
            const higherMean = stats1.mean > stats2.mean ? name1 : name2;
            const lowerMean = stats1.mean > stats2.mean ? name2 : name1;
            const higherValue = Math.max(stats1.mean, stats2.mean);
            const lowerValue = Math.min(stats1.mean, stats2.mean);
            const difference = Math.abs(stats1.mean - stats2.mean);
            const percentDiff = ((difference / lowerValue) * 100).toFixed(1);
            
            return `
                <div style="background: white; border: 1px solid #ddd; border-radius: 6px; padding: 12px; border-right: 4px solid #dc3545;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="font-weight: bold; color: #333; font-size: 14px;">
                            ${name1} vs ${name2}
                        </div>
                        <div style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: bold;">
                            p = ${tTest.pValue < 0.001 ? '<0.001' : tTest.pValue.toFixed(3)}
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 8px; font-size: 12px;">
                        <div style="background: #f8f9fa; padding: 6px; border-radius: 4px;">
                            <div style="font-weight: bold; color: #4facfe;">${name1}</div>
                            <div>×××•×¦×¢: ${stats1.mean.toFixed(4)}</div>
                            <div>×¡×˜×™×™×ª ×ª×§×Ÿ: ${stats1.std.toFixed(4)}</div>
                            <div>×“×’×™××•×ª: ${stats1.n}</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 6px; border-radius: 4px;">
                            <div style="font-weight: bold; color: #17a2b8;">${name2}</div>
                            <div>×××•×¦×¢: ${stats2.mean.toFixed(4)}</div>
                            <div>×¡×˜×™×™×ª ×ª×§×Ÿ: ${stats2.std.toFixed(4)}</div>
                            <div>×“×’×™××•×ª: ${stats2.n}</div>
                        </div>
                    </div>
                    
                    <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; padding: 8px; font-size: 12px;">
                        <div style="font-weight: bold; color: #856404; margin-bottom: 4px;">ğŸ“ˆ ××¡×§× ×”:</div>
                        <div style="color: #856404;">
                            <strong>${higherMean}</strong> ×’×‘×•×” ×-<strong>${lowerMean}</strong> ×‘-${difference.toFixed(4)} ×™×—×™×“×•×ª 
                            (${percentDiff}% ×™×•×ª×¨) - ×”×‘×“×œ ××•×‘×”×§ ×¡×˜×˜×™×¡×˜×™×ª
                        </div>
                    </div>
                </div>
            `;
        }

        // ========== ×¤×•× ×§×¦×™×•×ª ×”×©×•×•××•×ª ××•×ª×××•×ª ××™×©×™×ª ==========

        // ××ª×—×•×œ ×‘×•×—×¨×™ ×”×”×©×•×•××•×ª
        function initializeComparisonSelectors(results) {
            const availableRows = new Set();
            const availableColumns = new Set();
            const availableWells = new Set();
            
            results.forEach(result => {
                const row = result.well.charAt(0);
                const col = parseInt(result.well.substring(1));
                availableRows.add(row);
                availableColumns.add(col);
                availableWells.add(result.well);
            });
            
            // ×™×¦×™×¨×ª ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×©×•×¨×•×ª
            createRowSelectors(Array.from(availableRows).sort());
            
            // ×™×¦×™×¨×ª ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×¢××•×“×•×ª
            createColumnSelectors(Array.from(availableColumns).sort((a, b) => a - b));
            
            // ×™×¦×™×¨×ª ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×‘××¨×™×•×ª ××•×ª×××•×ª
            createCustomWellSelectors(Array.from(availableWells).sort((a, b) => {
                const [rowA, colA] = [a.charAt(0), parseInt(a.substring(1))];
                const [rowB, colB] = [b.charAt(0), parseInt(b.substring(1))];
                return rowA !== rowB ? rowA.localeCompare(rowB) : colA - colB;
            }));
        }

        function createRowSelectors(rows) {
            const groupAContainer = document.getElementById('rowGroupA');
            const groupBContainer = document.getElementById('rowGroupB');
            
            if (!groupAContainer || !groupBContainer) return;
            
            groupAContainer.innerHTML = '';
            groupBContainer.innerHTML = '';
            
            rows.forEach(row => {
                // ×›×¤×ª×•×¨ ×œ×§×‘×•×¦×” A
                const btnA = document.createElement('button');
                btnA.className = 'group-select-btn';
                btnA.textContent = row;
                btnA.style.background = ROW_COLORS[row];
                btnA.style.color = 'white';
                btnA.style.border = '2px solid ' + ROW_COLORS[row];
                btnA.onclick = () => toggleRowGroupSelection(row, 'A');
                groupAContainer.appendChild(btnA);
                
                // ×›×¤×ª×•×¨ ×œ×§×‘×•×¦×” B
                const btnB = document.createElement('button');
                btnB.className = 'group-select-btn';
                btnB.textContent = row;
                btnB.style.background = ROW_COLORS[row];
                btnB.style.color = 'white';
                btnB.style.border = '2px solid ' + ROW_COLORS[row];
                btnB.onclick = () => toggleRowGroupSelection(row, 'B');
                groupBContainer.appendChild(btnB);
            });
        }

        function createColumnSelectors(columns) {
            const groupAContainer = document.getElementById('colGroupA');
            const groupBContainer = document.getElementById('colGroupB');
            
            if (!groupAContainer || !groupBContainer) return;
            
            groupAContainer.innerHTML = '';
            groupBContainer.innerHTML = '';
            
            columns.forEach(col => {
                // ×›×¤×ª×•×¨ ×œ×§×‘×•×¦×” A
                const btnA = document.createElement('button');
                btnA.className = 'group-select-btn';
                btnA.textContent = col.toString();
                btnA.onclick = () => toggleColumnGroupSelection(col, 'A');
                groupAContainer.appendChild(btnA);
                
                // ×›×¤×ª×•×¨ ×œ×§×‘×•×¦×” B
                const btnB = document.createElement('button');
                btnB.className = 'group-select-btn';
                btnB.textContent = col.toString();
                btnB.onclick = () => toggleColumnGroupSelection(col, 'B');
                groupBContainer.appendChild(btnB);
            });
        }

        function createCustomWellSelectors(wells) {
            const groupAContainer = document.getElementById('customGroupAWells');
            const groupBContainer = document.getElementById('customGroupBWells');
            
            if (!groupAContainer || !groupBContainer) return;
            
            groupAContainer.innerHTML = '';
            groupBContainer.innerHTML = '';
            
            wells.forEach(well => {
                // ×›×¤×ª×•×¨ ×œ×§×‘×•×¦×” A
                const btnA = document.createElement('button');
                btnA.className = 'group-select-btn';
                btnA.textContent = well;
                btnA.style.fontSize = '11px';
                btnA.style.padding = '4px 8px';
                btnA.onclick = () => toggleCustomGroupSelection(well, 'A');
                groupAContainer.appendChild(btnA);
                
                // ×›×¤×ª×•×¨ ×œ×§×‘×•×¦×” B
                const btnB = document.createElement('button');
                btnB.className = 'group-select-btn';
                btnB.textContent = well;
                btnB.style.fontSize = '11px';
                btnB.style.padding = '4px 8px';
                btnB.onclick = () => toggleCustomGroupSelection(well, 'B');
                groupBContainer.appendChild(btnB);
            });
        }

        // ×”×—×œ×¤×ª ×˜××‘×™×
        function switchComparisonTab(tabName) {
            // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™ ×”×˜××‘×™×
            document.querySelectorAll('.comparison-tab').forEach(tab => {
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                    tab.style.background = '#ff9800';
                    tab.style.color = 'white';
                } else {
                    tab.classList.remove('active');
                    tab.style.background = '#e0e0e0';
                    tab.style.color = '#666';
                }
            });
            
            // ×”×¦×’×ª ×”×ª×•×›×Ÿ ×”××ª××™×
            document.getElementById('rowsComparisonTab').style.display = tabName === 'rows' ? 'block' : 'none';
            document.getElementById('columnsComparisonTab').style.display = tabName === 'columns' ? 'block' : 'none';
            document.getElementById('customComparisonTab').style.display = tabName === 'custom' ? 'block' : 'none';
        }

        // ×‘×—×™×¨×ª ×©×•×¨×•×ª ×œ×§×‘×•×¦×•×ª
        function toggleRowGroupSelection(row, group) {
            const groupSet = group === 'A' ? state.comparisonGroups.rowGroupA : state.comparisonGroups.rowGroupB;
            const listId = group === 'A' ? 'rowGroupAList' : 'rowGroupBList';
            const containerId = group === 'A' ? 'rowGroupA' : 'rowGroupB';
            
            if (groupSet.has(row)) {
                groupSet.delete(row);
            } else {
                groupSet.add(row);
            }
            
            updateGroupList(groupSet, listId, '×©×•×¨×•×ª');
            updateGroupButtons(containerId, groupSet, group);
        }

        // ×‘×—×™×¨×ª ×¢××•×“×•×ª ×œ×§×‘×•×¦×•×ª
        function toggleColumnGroupSelection(col, group) {
            const groupSet = group === 'A' ? state.comparisonGroups.colGroupA : state.comparisonGroups.colGroupB;
            const listId = group === 'A' ? 'colGroupAList' : 'colGroupBList';
            const containerId = group === 'A' ? 'colGroupA' : 'colGroupB';
            
            if (groupSet.has(col)) {
                groupSet.delete(col);
            } else {
                groupSet.add(col);
            }
            
            updateGroupList(groupSet, listId, '×¢××•×“×•×ª');
            updateGroupButtons(containerId, groupSet, group);
        }

        // ×‘×—×™×¨×ª ×‘××¨×™×•×ª ××•×ª×××•×ª ×œ×§×‘×•×¦×•×ª
        function toggleCustomGroupSelection(well, group) {
            const groupSet = group === 'A' ? state.comparisonGroups.customGroupA : state.comparisonGroups.customGroupB;
            const listId = group === 'A' ? 'customGroupAList' : 'customGroupBList';
            const containerId = group === 'A' ? 'customGroupAWells' : 'customGroupBWells';
            
            if (groupSet.has(well)) {
                groupSet.delete(well);
            } else {
                groupSet.add(well);
            }
            
            updateGroupList(groupSet, listId, '×‘××¨×™×•×ª');
            updateGroupButtons(containerId, groupSet, group);
        }

        // ×¢×“×›×•×Ÿ ×¨×©×™××ª ×”×§×‘×•×¦×”
        function updateGroupList(groupSet, listId, type) {
            const listElement = document.getElementById(listId);
            if (!listElement) return;
            
            if (groupSet.size === 0) {
                listElement.innerHTML = `<em>×œ× × ×‘×—×¨×• ${type}</em>`;
            } else {
                const items = Array.from(groupSet).sort((a, b) => {
                    if (typeof a === 'number') return a - b;
                    return a.localeCompare(b);
                });
                listElement.innerHTML = items.map(item => 
                    `<span style="background: #e3f2fd; padding: 2px 6px; margin: 2px; border-radius: 3px; display: inline-block;">${item}</span>`
                ).join('');
            }
        }

        // ×¢×“×›×•×Ÿ ××¨××” ×”×›×¤×ª×•×¨×™×
        function updateGroupButtons(containerId, groupSet, group) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const buttons = container.querySelectorAll('.group-select-btn');
            buttons.forEach(btn => {
                const value = btn.textContent.trim();
                const isSelected = groupSet.has(value) || groupSet.has(parseInt(value));
                
                if (isSelected) {
                    btn.classList.add(group === 'A' ? 'selected-a' : 'selected-b');
                } else {
                    btn.classList.remove('selected-a', 'selected-b');
                }
            });
        }

        // ×”×©×•×•××ª ×§×‘×•×¦×•×ª ×©×•×¨×•×ª
        function compareRowGroups() {
            const groupA = state.comparisonGroups.rowGroupA;
            const groupB = state.comparisonGroups.rowGroupB;
            
            if (groupA.size === 0 || groupB.size === 0) {
                alert('×× × ×‘×—×¨ ×œ×¤×—×•×ª ×©×•×¨×” ××—×ª ×‘×›×œ ×§×‘×•×¦×”');
                return;
            }
            
            const results = window.lastAnalysisResults;
            if (!results) {
                alert('×× × ×‘×¦×¢ × ×™×ª×•×— ×ª×—×™×œ×”');
                return;
            }
            
            // ××™×¡×•×£ ×”× ×ª×•× ×™× ××”×©×•×¨×•×ª ×”× ×‘×—×¨×•×ª
            const groupAData = results.filter(r => groupA.has(r.well.charAt(0)));
            const groupBData = results.filter(r => groupB.has(r.well.charAt(0)));
            
            if (groupAData.length === 0 || groupBData.length === 0) {
                alert('×œ× × ××¦××• × ×ª×•× ×™× ×¢×‘×•×¨ ×”×©×•×¨×•×ª ×”× ×‘×—×¨×•×ª');
                return;
            }
            
            const groupAValues = groupAData.map(r => r.colorStrength);
            const groupBValues = groupBData.map(r => r.colorStrength);
            
            const stats1 = calculateBasicStats(groupAValues);
            const stats2 = calculateBasicStats(groupBValues);
            const tTest = performTTest(groupAValues, groupBValues);
            
            const groupAName = `×©×•×¨×•×ª ${Array.from(groupA).sort().join(', ')}`;
            const groupBName = `×©×•×¨×•×ª ${Array.from(groupB).sort().join(', ')}`;
            
            displayCustomComparisonResults(groupAName, groupBName, stats1, stats2, tTest, groupAData, groupBData);
        }

        // ×”×©×•×•××ª ×§×‘×•×¦×•×ª ×¢××•×“×•×ª
        function compareColumnGroups() {
            const groupA = state.comparisonGroups.colGroupA;
            const groupB = state.comparisonGroups.colGroupB;
            
            if (groupA.size === 0 || groupB.size === 0) {
                alert('×× × ×‘×—×¨ ×œ×¤×—×•×ª ×¢××•×“×” ××—×ª ×‘×›×œ ×§×‘×•×¦×”');
                return;
            }
            
            const results = window.lastAnalysisResults;
            if (!results) {
                alert('×× × ×‘×¦×¢ × ×™×ª×•×— ×ª×—×™×œ×”');
                return;
            }
            
            const groupAData = results.filter(r => groupA.has(parseInt(r.well.substring(1))));
            const groupBData = results.filter(r => groupB.has(parseInt(r.well.substring(1))));
            
            if (groupAData.length === 0 || groupBData.length === 0) {
                alert('×œ× × ××¦××• × ×ª×•× ×™× ×¢×‘×•×¨ ×”×¢××•×“×•×ª ×”× ×‘×—×¨×•×ª');
                return;
            }
            
            const groupAValues = groupAData.map(r => r.colorStrength);
            const groupBValues = groupBData.map(r => r.colorStrength);
            
            const stats1 = calculateBasicStats(groupAValues);
            const stats2 = calculateBasicStats(groupBValues);
            const tTest = performTTest(groupAValues, groupBValues);
            
            const groupAName = `×¢××•×“×•×ª ${Array.from(groupA).sort((a,b) => a-b).join(', ')}`;
            const groupBName = `×¢××•×“×•×ª ${Array.from(groupB).sort((a,b) => a-b).join(', ')}`;
            
            displayCustomComparisonResults(groupAName, groupBName, stats1, stats2, tTest, groupAData, groupBData);
        }

        // ×”×©×•×•××ª ×§×‘×•×¦×•×ª ××•×ª×××•×ª
        function compareCustomGroups() {
            const groupA = state.comparisonGroups.customGroupA;
            const groupB = state.comparisonGroups.customGroupB;
            
            if (groupA.size === 0 || groupB.size === 0) {
                alert('×× × ×‘×—×¨ ×œ×¤×—×•×ª ×‘××¨×™×ª ××—×ª ×‘×›×œ ×§×‘×•×¦×”');
                return;
            }
            
            const results = window.lastAnalysisResults;
            if (!results) {
                alert('×× × ×‘×¦×¢ × ×™×ª×•×— ×ª×—×™×œ×”');
                return;
            }
            
            const groupAData = results.filter(r => groupA.has(r.well));
            const groupBData = results.filter(r => groupB.has(r.well));
            
            if (groupAData.length === 0 || groupBData.length === 0) {
                alert('×œ× × ××¦××• × ×ª×•× ×™× ×¢×‘×•×¨ ×”×‘××¨×™×•×ª ×”× ×‘×—×¨×•×ª');
                return;
            }
            
            const groupAValues = groupAData.map(r => r.colorStrength);
            const groupBValues = groupBData.map(r => r.colorStrength);
            
            const stats1 = calculateBasicStats(groupAValues);
            const stats2 = calculateBasicStats(groupBValues);
            const tTest = performTTest(groupAValues, groupBValues);
            
            const groupAName = `×§×‘×•×¦×” A (${Array.from(groupA).sort().join(', ')})`;
            const groupBName = `×§×‘×•×¦×” B (${Array.from(groupB).sort().join(', ')})`;
            
            displayCustomComparisonResults(groupAName, groupBName, stats1, stats2, tTest, groupAData, groupBData);
        }

        // ×”×¦×’×ª ×ª×•×¦××•×ª ×”×”×©×•×•××” ×”××•×ª×××ª
        function displayCustomComparisonResults(name1, name2, stats1, stats2, tTest, data1, data2) {
            const resultsDiv = document.getElementById('customComparisonResults');
            const contentDiv = document.getElementById('customComparisonContent');
            
            if (!resultsDiv || !contentDiv) return;
            
            const higherMean = stats1.mean > stats2.mean ? name1 : name2;
            const lowerMean = stats1.mean > stats2.mean ? name2 : name1;
            const difference = Math.abs(stats1.mean - stats2.mean);
            const percentDiff = ((difference / Math.min(stats1.mean, stats2.mean)) * 100).toFixed(1);
            
            let html = `
                <div style="background: ${tTest.significant ? '#fff3cd' : '#e8f5e8'}; border: 2px solid ${tTest.significant ? '#ffc107' : '#4caf50'}; border-radius: 8px; padding: 15px; margin-bottom: 20px; text-align: center;">
                    <div style="font-size: 32px; margin-bottom: 10px;">${tTest.significant ? 'âš ï¸' : 'âœ…'}</div>
                    <h5 style="color: ${tTest.significant ? '#856404' : '#2e7d32'}; margin-bottom: 8px;">
                        ${tTest.significant ? '×”×‘×“×œ ××•×‘×”×§ ×¡×˜×˜×™×¡×˜×™×ª!' : '××™×Ÿ ×”×‘×“×œ ××•×‘×”×§ ×¡×˜×˜×™×¡×˜×™×ª'}
                    </h5>
                    <p style="color: ${tTest.significant ? '#856404' : '#2e7d32'}; font-size: 13px; margin: 0;">
                        p-value = ${tTest.pValue < 0.001 ? '<0.001' : tTest.pValue.toFixed(4)}
                        ${tTest.significant ? ' (p < 0.05)' : ' (p â‰¥ 0.05)'}
                    </p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                    <div style="background: #e3f2fd; border: 1px solid #4facfe; border-radius: 8px; padding: 15px;">
                        <h6 style="color: #1976d2; margin-bottom: 10px; font-size: 14px;">${name1}</h6>
                        <div style="font-size: 13px; line-height: 1.8;">
                            <div><strong>××¡×¤×¨ ×“×’×™××•×ª:</strong> ${stats1.n}</div>
                            <div><strong>×××•×¦×¢:</strong> ${stats1.mean.toFixed(4)}</div>
                            <div><strong>×¡×˜×™×™×ª ×ª×§×Ÿ:</strong> ${stats1.std.toFixed(4)}</div>
                            <div><strong>××™× ×™××•×:</strong> ${stats1.min.toFixed(4)}</div>
                            <div><strong>××§×¡×™××•×:</strong> ${stats1.max.toFixed(4)}</div>
                            <div><strong>×¨×•×•×— ×‘×˜×—×•×Ÿ 95%:</strong><br>${stats1.confidenceInterval[0].toFixed(4)} - ${stats1.confidenceInterval[1].toFixed(4)}</div>
                        </div>
                        <div style="margin-top: 10px; padding: 8px; background: white; border-radius: 5px; font-size: 11px; max-height: 100px; overflow-y: auto;">
                            <strong>×‘××¨×™×•×ª:</strong> ${data1.map(d => d.well).join(', ')}
                        </div>
                    </div>
                    
                    <div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 8px; padding: 15px;">
                        <h6 style="color: #2e7d32; margin-bottom: 10px; font-size: 14px;">${name2}</h6>
                        <div style="font-size: 13px; line-height: 1.8;">
                            <div><strong>××¡×¤×¨ ×“×’×™××•×ª:</strong> ${stats2.n}</div>
                            <div><strong>×××•×¦×¢:</strong> ${stats2.mean.toFixed(4)}</div>
                            <div><strong>×¡×˜×™×™×ª ×ª×§×Ÿ:</strong> ${stats2.std.toFixed(4)}</div>
                            <div><strong>××™× ×™××•×:</strong> ${stats2.min.toFixed(4)}</div>
                            <div><strong>××§×¡×™××•×:</strong> ${stats2.max.toFixed(4)}</div>
                            <div><strong>×¨×•×•×— ×‘×˜×—×•×Ÿ 95%:</strong><br>${stats2.confidenceInterval[0].toFixed(4)} - ${stats2.confidenceInterval[1].toFixed(4)}</div>
                        </div>
                        <div style="margin-top: 10px; padding: 8px; background: white; border-radius: 5px; font-size: 11px; max-height: 100px; overflow-y: auto;">
                            <strong>×‘××¨×™×•×ª:</strong> ${data2.map(d => d.well).join(', ')}
                        </div>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding: 15px;">
                    <h6 style="color: #333; margin-bottom: 10px;">ğŸ“Š ×¤×¨×˜×™ ×”×‘×“×™×§×” ×”×¡×˜×˜×™×¡×˜×™×ª:</h6>
                    <div style="font-size: 13px; line-height: 1.8;">
                        <div><strong>×¡×•×’ ×‘×“×™×§×”:</strong> Welch's t-test (×“×•-×–× ×‘×™)</div>
                        <div><strong>t-statistic:</strong> ${tTest.tStatistic.toFixed(4)}</div>
                        <div><strong>×“×¨×’×•×ª ×—×•×¤×©:</strong> ${tTest.degreesOfFreedom.toFixed(2)}</div>
                        <div><strong>p-value:</strong> ${tTest.pValue < 0.001 ? '<0.001' : tTest.pValue.toFixed(4)}</div>
                        <div><strong>×”×‘×“×œ ×‘×××•×¦×¢×™×:</strong> ${difference.toFixed(4)} (${percentDiff}%)</div>
                    </div>
                </div>
                
                ${tTest.significant ? `
                    <div style="background: #fff3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 12px; margin-top: 15px;">
                        <div style="font-weight: bold; color: #856404; margin-bottom: 6px;">ğŸ“ˆ ××¡×§× ×”:</div>
                        <div style="color: #856404; font-size: 13px;">
                            <strong>${higherMean}</strong> ×’×‘×•×” ×-<strong>${lowerMean}</strong> ×‘-${difference.toFixed(4)} ×™×—×™×“×•×ª 
                            (${percentDiff}% ×™×•×ª×¨) - ×”×‘×“×œ ××•×‘×”×§ ×¡×˜×˜×™×¡×˜×™×ª ×‘×¨××ª ××•×‘×”×§×•×ª ×©×œ 95%.
                        </div>
                    </div>
                ` : `
                    <div style="background: #e8f5e8; border: 1px solid #4caf50; border-radius: 8px; padding: 12px; margin-top: 15px;">
                        <div style="font-weight: bold; color: #2e7d32; margin-bottom: 6px;">ğŸ“ˆ ××¡×§× ×”:</div>
                        <div style="color: #2e7d32; font-size: 13px;">
                            ×œ× × ××¦× ×”×‘×“×œ ××•×‘×”×§ ×¡×˜×˜×™×¡×˜×™×ª ×‘×™×Ÿ ×”×§×‘×•×¦×•×ª. 
                            ×”×”×‘×“×œ ×‘×××•×¦×¢×™× (${difference.toFixed(4)}) ×™×›×•×œ ×œ×”×™×•×ª ×ª×•×¦××” ×©×œ ×©×•× ×•×ª ××§×¨××™×ª.
                        </div>
                    </div>
                `}
            `;
            
            contentDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
            
            // ×’×œ×™×œ×” ×œ×ª×•×¦××•×ª
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // ×¤×•× ×§×¦×™×•×ª ×¢×–×¨×”
        function showHelp() {
            document.getElementById('helpModal').style.display = 'block';
        }

        function closeHelp() {
            document.getElementById('helpModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('helpModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a8d4338939ccd41',t:'MTc2NDg3MTg0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>